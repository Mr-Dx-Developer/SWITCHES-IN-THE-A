import{f as J,au as Q,av as Z,R as ee,b1 as te,b2 as le,h as p,A as R,ao as ie,aG as Y,b3 as B,l as I,b4 as ne,b5 as $,aw as W,b6 as se}from"./index-1c6b3dd3.js";function D(i){return i&-i}class oe{constructor(l,s){this.l=l,this.min=s;const u=new Array(l+1);for(let o=0;o<l+1;++o)u[o]=0;this.ft=u}add(l,s){if(s===0)return;const{l:u,ft:o}=this;for(l+=1;l<=u;)o[l]+=s,l+=D(l)}get(l){return this.sum(l+1)-this.sum(l)}sum(l){if(l===void 0&&(l=this.l),l<=0)return 0;const{ft:s,min:u,l:o}=this;if(l>o)throw new Error("[FinweckTree.sum]: `i` is larger than length.");let r=l*u;for(;l>0;)r+=s[l],l-=D(l);return r}getBound(l){let s=0,u=this.l;for(;u>s;){const o=Math.floor((s+u)/2),r=this.sum(o);if(r>l){u=o;continue}else if(r<l){if(s===o)return this.sum(s+1)<=l?s+1:o;s=o}else return o}return s}}let E;function re(){return E===void 0&&("matchMedia"in window?E=window.matchMedia("(pointer:coarse)").matches:E=!1),E}let _;function X(){return _===void 0&&(_="chrome"in window?window.devicePixelRatio:1),_}const ae=W(".v-vl",{maxHeight:"inherit",height:"100%",overflow:"auto",minWidth:"1px"},[W("&:not(.v-vl--show-scrollbar)",{scrollbarWidth:"none"},[W("&::-webkit-scrollbar, &::-webkit-scrollbar-track-piece, &::-webkit-scrollbar-thumb",{width:0,height:0,display:"none"})])]),ce=J({name:"VirtualList",inheritAttrs:!1,props:{showScrollbar:{type:Boolean,default:!0},items:{type:Array,default:()=>[]},itemSize:{type:Number,required:!0},itemResizable:Boolean,itemsStyle:[String,Object],visibleItemsTag:{type:[String,Object],default:"div"},visibleItemsProps:Object,ignoreItemResize:Boolean,onScroll:Function,onWheel:Function,onResize:Function,defaultScrollKey:[Number,String],defaultScrollIndex:Number,keyField:{type:String,default:"key"},paddingTop:{type:[Number,String],default:0},paddingBottom:{type:[Number,String],default:0}},setup(i){const l=Q();ae.mount({id:"vueuc/virtual-list",head:!0,anchorMetaName:Z,ssr:l}),ee(()=>{const{defaultScrollIndex:e,defaultScrollKey:t}=i;e!=null?z({index:e}):t!=null&&z({key:t})});let s=!1,u=!1;te(()=>{if(s=!1,!u){u=!0;return}z({top:H.value,left:x})}),le(()=>{s=!0,u||(u=!0)});const o=p(()=>{const e=new Map,{keyField:t}=i;return i.items.forEach((n,c)=>{e.set(n[t],c)}),e}),r=R(null),g=R(void 0),m=new Map,b=p(()=>{const{items:e,itemSize:t,keyField:n}=i,c=new oe(e.length,t);return e.forEach((f,d)=>{const a=f[n],h=m.get(a);h!==void 0&&c.add(d,h)}),c}),w=R(0);let x=0;const H=R(0),O=ie(()=>Math.max(b.value.getBound(H.value-Y(i.paddingTop))-1,0)),C=p(()=>{const{value:e}=g;if(e===void 0)return[];const{items:t,itemSize:n}=i,c=O.value,f=Math.min(c+Math.ceil(e/n+1),t.length-1),d=[];for(let a=c;a<=f;++a)d.push(t[a]);return d}),z=(e,t)=>{if(typeof e=="number"){M(e,t,"auto");return}const{left:n,top:c,index:f,key:d,position:a,behavior:h,debounce:v=!0}=e;if(n!==void 0||c!==void 0)M(n,c,h);else if(f!==void 0)V(f,h,v);else if(d!==void 0){const N=o.value.get(d);N!==void 0&&V(N,h,v)}else a==="bottom"?M(0,Number.MAX_SAFE_INTEGER,h):a==="top"&&M(0,0,h)};let S,k=null;function V(e,t,n){const{value:c}=b,f=c.sum(e)+Y(i.paddingTop);if(!n)r.value.scrollTo({left:0,top:f,behavior:t});else{S=e,k!==null&&window.clearTimeout(k),k=window.setTimeout(()=>{S=void 0,k=null},16);const{scrollTop:d,offsetHeight:a}=r.value;if(f>d){const h=c.get(e);f+h<=d+a||r.value.scrollTo({left:0,top:f+h-a,behavior:t})}else r.value.scrollTo({left:0,top:f,behavior:t})}}function M(e,t,n){r.value.scrollTo({left:e,top:t,behavior:n})}function G(e,t){var n,c,f;if(s||i.ignoreItemResize||j(t.target))return;const{value:d}=b,a=o.value.get(e),h=d.get(a),v=(f=(c=(n=t.borderBoxSize)===null||n===void 0?void 0:n[0])===null||c===void 0?void 0:c.blockSize)!==null&&f!==void 0?f:t.contentRect.height;if(v===h)return;v-i.itemSize===0?m.delete(e):m.set(e,v-i.itemSize);const T=v-h;if(T===0)return;d.add(a,T);const y=r.value;if(y!=null){if(S===void 0){const A=d.sum(a);y.scrollTop>A&&y.scrollBy(0,T)}else if(a<S)y.scrollBy(0,T);else if(a===S){const A=d.sum(a);v+A>y.scrollTop+y.offsetHeight&&y.scrollBy(0,T)}L()}w.value++}const P=!re();let F=!1;function K(e){var t;(t=i.onScroll)===null||t===void 0||t.call(i,e),(!P||!F)&&L()}function U(e){var t;if((t=i.onWheel)===null||t===void 0||t.call(i,e),P){const n=r.value;if(n!=null){if(e.deltaX===0&&(n.scrollTop===0&&e.deltaY<=0||n.scrollTop+n.offsetHeight>=n.scrollHeight&&e.deltaY>=0))return;e.preventDefault(),n.scrollTop+=e.deltaY/X(),n.scrollLeft+=e.deltaX/X(),L(),F=!0,se(()=>{F=!1})}}}function q(e){if(s||j(e.target)||e.contentRect.height===g.value)return;g.value=e.contentRect.height;const{onResize:t}=i;t!==void 0&&t(e)}function L(){const{value:e}=r;e!=null&&(H.value=e.scrollTop,x=e.scrollLeft)}function j(e){let t=e;for(;t!==null;){if(t.style.display==="none")return!0;t=t.parentElement}return!1}return{listHeight:g,listStyle:{overflow:"auto"},keyToIndex:o,itemsStyle:p(()=>{const{itemResizable:e}=i,t=B(b.value.sum());return w.value,[i.itemsStyle,{boxSizing:"content-box",height:e?"":t,minHeight:e?t:"",paddingTop:B(i.paddingTop),paddingBottom:B(i.paddingBottom)}]}),visibleItemsStyle:p(()=>(w.value,{transform:`translateY(${B(b.value.sum(O.value))})`})),viewportItems:C,listElRef:r,itemsElRef:R(null),scrollTo:z,handleListResize:q,handleListScroll:K,handleListWheel:U,handleItemResize:G}},render(){const{itemResizable:i,keyField:l,keyToIndex:s,visibleItemsTag:u}=this;return I($,{onResize:this.handleListResize},{default:()=>{var o,r;return I("div",ne(this.$attrs,{class:["v-vl",this.showScrollbar&&"v-vl--show-scrollbar"],onScroll:this.handleListScroll,onWheel:this.handleListWheel,ref:"listElRef"}),[this.items.length!==0?I("div",{ref:"itemsElRef",class:"v-vl-items",style:this.itemsStyle},[I(u,Object.assign({class:"v-vl-visible-items",style:this.visibleItemsStyle},this.visibleItemsProps),{default:()=>this.viewportItems.map(g=>{const m=g[l],b=s.get(m),w=this.$slots.default({item:g,index:b})[0];return i?I($,{key:m,onResize:x=>this.handleItemResize(m,x)},{default:()=>w}):(w.key=m,w)})})]):(r=(o=this.$slots).empty)===null||r===void 0?void 0:r.call(o)])}})}});export{ce as V};
