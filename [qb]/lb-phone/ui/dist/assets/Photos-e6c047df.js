import{r as E,a as A,F as j,j as e}from"./jsx-runtime-f40812bf.js";import{s as $,u as _,as as le,A as z,m as G,az as ce,I as oe,an as de,ai as ue,o as Pe,aA as me,aB as ve,aC as fe,a as ne,T as Ae,ay as ee,ae as te,aD as se,aE as he,aF as Se,aG as Oe,aH as Ee}from"./index.esm-497ba86e.js";import{o as S,f as I,d as h,y as ge,L as t,z as q,C as H,h as re,O as pe,Q as Ce,R as Te,g as K,v as J,D as be,b as ae,U as Q}from"./Phone-3c5ec2e3.js";import{r as Ie,f as Me}from"./number-28525126.js";const X=({src:o,showAdvanced:s})=>{const[n,m]=E.useState(null);return A(j,{children:[e("video",{src:o,crossOrigin:"anonymous",controls:!1,onMouseOver:T=>{s&&T.currentTarget.play()},onMouseOut:T=>{s&&T.currentTarget.pause()},muted:!0,loop:!0,onLoadedMetadata:T=>{m(T.currentTarget.duration)}}),n&&s&&e("div",{className:"video-duration",children:(T=>{const M=Math.floor(T/60),y=Ie(T-M*60,0);return`${M}:${y<10?"0"+y:y}`})(n)})]})},U=$(null),Y=[{title:t("APPS.PHOTOS.VIDEOS"),id:"videos",icon:e(ue,{}),count:0},{title:t("APPS.PHOTOS.SELFIES"),id:"selfies",icon:e(Pe,{}),count:0},{title:t("APPS.PHOTOS.SCREENSHOTS"),id:"screenshots",icon:e(me,{}),count:0},{title:t("APPS.PHOTOS.IMPORTS"),id:"imports",icon:e(ve,{}),count:0},{title:t("APPS.PHOTOS.DUPLICATES"),id:"duplicates",icon:e(fe,{}),count:0}];function Ne(){const o=_(U),[s,n]=E.useState(!1),m=E.useRef(null),[g,T]=E.useState([]),[M,y]=E.useState(Y);E.useEffect(()=>{S.APPS.CAMERA.albums.value&&S.APPS.CAMERA.mediaTypes.value?(T(S.APPS.CAMERA.albums.value),y(S.APPS.CAMERA.mediaTypes.value)):I("Camera",{action:"getAlbums"}).then(u=>{if(!u)return h("error","No data received from server");let b=M.map(C=>{const R=u.mediaTypes.find(O=>O.id===C.id);return R?{...C,count:R.count}:C});T(u.albums),y(b),S.APPS.CAMERA.albums.set(u.albums),S.APPS.CAMERA.mediaTypes.set(b)})},[o]),E.useEffect(()=>m!=null&&m.current?(m.current.addEventListener("wheel",u=>{u.preventDefault(),m.current.scrollLeft+=u.deltaY}),()=>{m!=null&&m.current&&(m==null||m.current.removeEventListener("wheel",u=>{u.preventDefault(),m.current.scrollLeft+=u.deltaY}))}):h("warning","Scroll container not found"),[m==null?void 0:m.current]);const L=()=>{let u="";H.PopUp.set({title:t("APPS.PHOTOS.NEW_ALBUM_POPUP.TITLE"),description:t("APPS.PHOTOS.NEW_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.NEW_ALBUM_POPUP.PLACEHOLDER"),maxCharacters:20,onChange:b=>{u=b}},buttons:[{title:t("APPS.PHOTOS.NEW_ALBUM_POPUP.CANCEL")},{title:t("APPS.PHOTOS.NEW_ALBUM_POPUP.PROCEED"),cb:()=>{I("Camera",{action:"createAlbum",title:u}).then(b=>{if(!b)return h("warning","Could not create album, id not returned");if(u.length<1)return h("warning","Input is empty, cannot create album");if(u.length>20)return h("warning","Input is too long, cannot create album");let C={title:u,id:b,cover:null,count:0};T([...g,C]),S.APPS.CAMERA.albums.value=[...g,C]})}}]})},B=u=>{if(!u)return h("warning","No album id provided, cannot remove album");H.PopUp.set({title:t("APPS.PHOTOS.REMOVE_ALBUM.TITLE").format({name:u.title}),description:t("APPS.PHOTOS.REMOVE_ALBUM.DESCRIPTION").format({name:u.title}),buttons:[{title:t("APPS.PHOTOS.REMOVE_ALBUM.CANCEL")},{title:t("APPS.PHOTOS.REMOVE_ALBUM.PROCEED"),color:"red",cb:()=>{I("Camera",{action:"deleteAlbum",id:u.id}).then(b=>{if(!b)return h("error","Could not remove album, server returned false");S.APPS.CAMERA.albums.set(g.filter(C=>C.id!==u.id)),T(g.filter(C=>C.id!==u.id))})}}]})},P=ge(u=>{let b=u.target;for(;!b.classList.contains("album");)b=b.parentElement;let C=parseInt(b.getAttribute("data-id"));if(!C)return h("warning","Could not obtain album id from element");H.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),cb:()=>{let R="";H.PopUp.set({title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),description:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PLACEHOLDER"),minCharacters:1,maxCharacters:20,onChange:O=>{R=O}},buttons:[{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.CANCEL")},{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PROCEED"),cb:()=>{if(R.length<1)return h("warning","Input is empty, cannot rename album");h("warning","Renaming album",C,R),I("Camera",{action:"renameAlbum",id:C,title:R}).then(O=>{if(!O)return h("error","Could not rename album, server returned false");T(g.map(c=>c.id===C?{...c,title:R}:c)),S.APPS.CAMERA.albums.set(g.map(c=>c.id===C?{...c,title:R}:c))})}}]})}},{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>B(g.find(R=>R.id===C))}]})});return e(j,{children:o?e(z,{children:e(Le,{})}):A(j,{children:[A("div",{className:"albums-header",children:[A("div",{className:"top",children:[e(le,{onClick:L}),e("div",{className:"edit",onClick:()=>n(!s),children:s?t("APPS.PHOTOS.DONE"):t("APPS.PHOTOS.EDIT")})]}),e("div",{className:"title",children:t("APPS.PHOTOS.ALBUMS")})]}),A("div",{className:"albums-content",children:[e("div",{className:"subtitle",children:t("APPS.PHOTOS.MY_ALBUMS")}),e("div",{className:"albums-grid","data-edit":s,ref:m,children:e(z,{children:g.map((u,b)=>A(G.div,{animate:{scale:1},exit:{scale:.2},transition:{duration:.25,ease:"easeInOut"},className:"album","data-id":u.id,"data-removable":u.removable,...P,onClick:()=>{s||U.set(u)},children:[s&&u.removable!==!1&&e("div",{className:"remove",onClick:C=>{C.stopPropagation(),B(u)},children:e(ce,{})}),A("div",{className:"cover",children:[q(u.cover)?e(X,{src:u.cover,showAdvanced:!1}):e("img",{src:u.cover??"https://join.travelmanagers.com.au/wp-content/uploads/2017/09/default-placeholder-300x300.png"}),u.id==="favourites"&&e(oe,{})]}),A("div",{className:"text",children:[e("div",{className:"title",children:u.title}),e("div",{className:"count",children:Me(u.count)})]})]},b))})})]}),e("div",{className:"divider"}),A("div",{className:"media-types",children:[e("div",{className:"subtitle",children:t("APPS.PHOTOS.MEDIA_TYPES")}),e("div",{className:"media-types-items",children:M.map((u,b)=>A("div",{className:"item",onClick:()=>{if(s)return h("info","Edit mode is enabled, cannot open media type");U.set({...u,id:null,cover:null,type:u.id})},children:[A("div",{className:"type",children:[u.icon,u.title]}),A("div",{className:"action",children:[e("div",{className:"count",children:u.count}),e(de,{})]})]},b))})]})]})})}const Le=()=>{const o=_(U),s=_(w),[n,m]=E.useState([]),[g,T]=E.useState([]),[M,y]=E.useState(!1),[L,B]=E.useState(!1),[P,u]=E.useState(!1),[b,C]=E.useState(0);E.useEffect(()=>{I("Camera",{action:"getImages",filter:{album:o.id,type:o.type}}).then(O=>{if(!O)return h("warning","No data was returned from getImages event");T(O.reverse()),y(O.length===0)})},[]);const R=O=>{if(L||P)return;let c=document.querySelector("#last");if(!c)return;!J(c)&&(u(!0),I("Camera",{action:"getImages",page:b+1,filter:{album:o.id,type:o.type}}).then(i=>{i&&i.length>0?(T([...i.reverse(),...g]),u(!1),i.length<32&&B(!0)):B(!0)}),C(i=>i+1))};return A(G.div,{initial:{opacity:0,x:35},animate:{opacity:1,x:0},exit:{opacity:0,x:35},transition:{duration:.25,ease:"easeInOut"},children:[A("div",{className:"library-header",children:[A("div",{className:"top",children:[e("div",{className:"info",children:A("div",{className:"back",style:{color:g.length<15?"var(--phone-color-blue)":"#ffffff"},onClick:()=>{s&&w.set(!1),U.set(null)},children:[e(ne,{}),t("APPS.PHOTOS.ALBUMS")]})}),A("div",{className:"actions",style:{color:g.length<15?"var(--phone-color-blue)":"var(--phone-text-primary)"},children:[e("div",{className:"button",onClick:()=>w.set(!s),children:s?t("APPS.PHOTOS.DONE"):t("APPS.PHOTOS.SELECT")}),e("div",{className:"button round",onClick:()=>{let O=o.id!=="recents"&&o.id!=="favourites";H.ContextMenu.set({buttons:[re.value.AllowExternal.Gallery&&o.id!=="favourites"&&{title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.TITLE"),cb:()=>{let c="";H.PopUp.set({title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.TITLE"),description:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.PLACEHOLDER"),onChange:r=>{c=r}},buttons:[{title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.CANCEL")},{title:t("APPS.PHOTOS.IMPORT_IMAGE_POPUP.PROCEED"),cb:()=>{if(c.includes("data:image"))return h("warning","Data URL not supported");if(!pe(c)){setTimeout(()=>{H.PopUp.set({title:t("COMPONENTS.GALLERY.EXTERNAL_URL"),description:t("COMPONENTS.GALLERY.EXTERNAL_URL_BLACKLISTED"),buttons:[{title:"OK"}]}),h("warning","External URL is blacklisted")},500);return}Ce(c,r=>{if(!r)return h("error","Image does not exist");Te(c,null,"import",!0).then(i=>{if(!i)return h("error","Could not save to gallery, server returned false");let d=q(c);T([{id:i,src:c,timestamp:Date.now(),type:"import",isVideo:d},...g]),I("Camera",{action:"getAlbums"}).then(v=>{if(!v)return h("error","No data received from server");let p=Y.map(N=>{const a=v.mediaTypes.find(l=>l.id===N.id);return a?{...N,count:a.count}:N});S.APPS.CAMERA.albums.set(v.albums),S.APPS.CAMERA.mediaTypes.set(p)}),U.set({...o,photoCount:d?o.photoCount:o.photoCount+1,videoCount:d?o.videoCount+1:o.videoCount})})})}}]})}},O&&{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),cb:()=>{let c="";H.PopUp.set({title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),description:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PLACEHOLDER"),minCharacters:1,maxCharacters:20,onChange:r=>{c=r}},buttons:[{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.CANCEL")},{title:t("APPS.PHOTOS.RENAME_ALBUM_POPUP.PROCEED"),cb:()=>{if(c.length<1)return h("warning","Input is empty, cannot rename album");h("info","Renaming album",o.id,c),I("Camera",{action:"renameAlbum",id:o.id,title:c}).then(r=>{if(!r)return h("error","Could not rename album, server returned false");U.set({...o,title:c}),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(i=>i.id===o.id?{...i,title:c}:i))})}}]})}},O&&{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{H.PopUp.set({title:t("APPS.PHOTOS.REMOVE_ALBUM.TITLE").format({name:o.title}),description:t("APPS.PHOTOS.REMOVE_ALBUM.DESCRIPTION").format({name:o.title}),buttons:[{title:t("APPS.PHOTOS.REMOVE_ALBUM.CANCEL")},{title:t("APPS.PHOTOS.REMOVE_ALBUM.PROCEED"),color:"red",cb:()=>{I("Camera",{action:"deleteAlbum",id:o.id}).then(c=>{if(!c)return h("error","Could not remove album, server returned false");S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.filter(r=>r.id!==o.id)),U.set(null)})}}]})}}]})},children:e(Ae,{})})]})]}),e("div",{className:"name",style:{color:g.length<15?"var(--phone-text-primary)":"#ffffff"},children:o.title})]}),A("div",{className:"library-content","data-offset":g.length<15,onScroll:R,children:[M&&A("div",{className:"no-photos",children:[e("div",{className:"title",children:t("APPS.PHOTOS.NO_PHOTOS")}),e("div",{className:"description",children:t("APPS.PHOTOS.NO_PHOTOS_INSTRUCTIONS")})]}),!s&&o.photoCount!==void 0&&!M&&e("div",{className:"info",children:t("APPS.PHOTOS.PHOTO_COUNT").format({photos:o.photoCount,videos:o.videoCount})}),e("div",{className:"library-grid",children:g.map((O,c)=>A("div",{id:c===0?"last":"",className:"grid-item",onClick:()=>{if(s){const i=n.find(d=>d.id===O.id);m(i?n.filter(d=>d.id!==O.id):[...n,O])}else V.set({activeImage:O,images:g})},children:[O.isVideo?e(X,{src:O.src,showAdvanced:!s}):e("div",{className:"img",style:{backgroundImage:`url(${O.src})`}}),e("div",{className:"checkbox",children:s&&(n.find(i=>i.id===O.id)?e(K,{checked:!0}):e(K,{checked:!1}))})]},c))})]}),s&&A("div",{className:"select-footer",children:[e("div",{className:"icons","data-disabled":n.length===0,children:e(ee,{})}),e("div",{className:"title",children:n.length===0?t("APPS.PHOTOS.SELECT_ITEMS"):t("APPS.PHOTOS.SELECTED_COUNT").format({count:n.length})}),A("div",{className:"icons","data-disabled":n.length===0,children:[e(te,{onClick:()=>{if(n.length===0)return;let O=o.id!=="recents"&&o.id!=="favourites";H.ContextMenu.set({title:O&&t("APPS.PHOTOS.DELETE_CONTEXT_TITLE").format({type:n.length>1?t("APPS.PHOTOS.THESE_PHOTOS"):t("APPS.PHOTOS.THIS_PHOTO")}),buttons:[O&&{title:t("APPS.PHOTOS.REMOVE_FROM_ALBUM"),cb:()=>{I("Camera",{action:"removeFromAlbum",album:o.id,ids:n.map(c=>c.id)}).then(c=>{if(!c)return h("error","Could not remove from album, server returned false");let r=o.photoCount-n.filter(d=>!d.isVideo).length,i=o.videoCount-n.filter(d=>d.isVideo).length;S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(d=>{if(d.id===o.id)return{...d,count:d.count-n.length,photoCount:r,videoCount:i}})),U.set({...o,photoCount:r,videoCount:i}),T(g.filter(d=>!n.find(v=>d.id===v.id))),m([]),w.set(!1)})}},{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{I("Camera",{action:"deleteFromGallery",ids:n.map(c=>c.id)}).then(c=>{if(!c)return h("error","Could not delete from gallery, server returned false");let r=0;n.forEach(v=>{r+=v.size}),window.postMessage({action:"phone:updateStorage",add:!1,size:r});let i=o.photoCount-n.filter(v=>!v.isVideo).length,d=o.videoCount-n.filter(v=>v.isVideo).length;I("Camera",{action:"getAlbums"}).then(v=>{if(!v)return h("error","No data received from server");let p=Y.map(N=>{const a=v.mediaTypes.find(l=>l.id===N.id);return a?{...N,count:a.count}:N});S.APPS.CAMERA.albums.set(v.albums),S.APPS.CAMERA.mediaTypes.set(p)}),U.set({...o,photoCount:i,videoCount:d}),T(g.filter(v=>!n.find(p=>v.id===p.id))),m([]),w.set(!1)})}}]})}}),e(se,{onClick:()=>{n.length!==0&&H.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{x.set({images:n,onSelect:O=>{I("Camera",{action:"addToAlbum",album:O.id,ids:n.map(c=>c.id)}).then(c=>{if(!c)return h("error","Could not add to album, server returned false");m([]),w.set(!1),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(r=>r.id===O.id?{...r,count:r.count+n.length,photoCount:r.photoCount+n.filter(i=>!i.isVideo).length,videoCount:r.videoCount+n.filter(i=>i.isVideo).length,cover:n[n.length-1].src}:r))})}})}},{title:t("APPS.PHOTOS.ADD_TO_FAVOURITES"),cb:()=>{I("Camera",{action:"toggleFavourites",ids:n.map(O=>O.id),favourite:!0}).then(O=>{if(!O)return h("error","Could not add to favourites, server returned false");m([]),w.set(!1),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(c=>c.id==="favourites"?{...c,count:c.count+n.length,photoCount:c.photoCount+n.filter(r=>!r.isVideo).length,videoCount:c.videoCount+n.filter(r=>r.isVideo).length,cover:n[n.length-1].src}:c))})}}]})}})]})]})]})};t("APPS.PHOTOS.YEARS"),t("APPS.PHOTOS.MONTHS"),t("APPS.PHOTOS.DAYS"),t("APPS.PHOTOS.ALL_PHOTOS");function Re(){const o=_(w),[s,n]=E.useState([]),[m,g]=E.useState([]),[T,M]=E.useState(!1);E.useState("all");const[y,L]=E.useState(null),[B,P]=E.useState(!1),[u,b]=E.useState(!1),[C,R]=E.useState(0),O=()=>{var W,ie;let i=[],d=document.querySelectorAll(".grid-item");if(d.length===0||(d.forEach(F=>{!J(F)&&i.push(F)}),i.length===0))return L(null);let v=i[0],p=parseInt(v==null?void 0:v.getAttribute("data-id"));if(!p)return;let N=(W=m.find(F=>F.id===p))==null?void 0:W.timestamp,a=i[i.length-1],l=parseInt(a.getAttribute("data-id")),f;if(l&&(f=(ie=m.find(F=>F.id===l))==null?void 0:ie.timestamp),!N)return;let D=c(N),k=c(f);if(D===k||!f)return L(D);L(`${D} - ${k}`)},c=i=>{let d=new Date(i/1e3),v=d.toLocaleString("default",{month:"short"}),p=d.getDate(),N=d.getFullYear();return`${p} ${v} ${N}`};E.useEffect(()=>{I("Camera",{action:"getImages"}).then(i=>{if(!i)return h("warning","No data was returned from getImages event");g(i.reverse()),M(i.length===0)})},[]);const r=i=>{if(O(),B||u)return;let d=document.querySelector("#last");if(!d)return;!J(d)&&(b(!0),I("Camera",{action:"getImages",page:C+1}).then(p=>{p&&p.length>0?(g([...p.reverse(),...m]),b(!1),p.length<32&&P(!0)):P(!0)}),R(p=>p+1))};return A(j,{children:[e("div",{className:"library-header",children:A("div",{className:"top",children:[e("div",{className:"info",children:e("div",{className:"date",style:{color:m.length<15?"var(--phone-text-primary)":"#ffffff"},children:y&&y})}),e("div",{className:"actions",children:e("div",{className:"button",onClick:()=>w.set(!o),children:o?t("APPS.PHOTOS.DONE"):t("APPS.PHOTOS.SELECT")})})]})}),e("div",{className:"library-content","data-offset":m.length<15,onScroll:r,children:e("div",{className:"library-grid","data-zoomlevel":De[1].toString(),children:m.map((i,d)=>A("div",{id:d===0?"last":"",className:"grid-item","data-id":i.id,onClick:()=>{if(o){const p=s.find(N=>N.id===i.id);n(p?s.filter(N=>N.id!==i.id):[...s,i])}else V.set({activeImage:i,images:m})},children:[i.isVideo?e(X,{src:i.src,showAdvanced:!o}):e("div",{className:"img",style:{backgroundImage:`url(${i.src})`}}),e("div",{className:"checkbox",children:o&&(s.find(p=>p.id===i.id)?e(K,{checked:!0}):e(K,{checked:!1}))})]}))})}),o&&A("div",{className:"select-footer",children:[e("div",{className:"icons","data-disabled":s.length===0,children:e(ee,{})}),e("div",{className:"title",children:s.length===0?t("APPS.PHOTOS.SELECT_ITEMS"):t("APPS.PHOTOS.SELECTED_COUNT").format({count:s.length})}),A("div",{className:"icons","data-disabled":s.length===0,children:[e(te,{onClick:()=>{s.length!==0&&H.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{I("Camera",{action:"deleteFromGallery",ids:s.map(i=>i.id)}).then(()=>{g(m.filter(d=>!s.find(v=>d.src===v.src))),n([]);let i=0;s.forEach(d=>{i+=d.size}),window.postMessage({action:"phone:updateStorage",add:!1,size:i}),I("Camera",{action:"getAlbums"}).then(d=>{if(!d)return h("error","No data received from server");let v=Y.map(p=>{const N=d.mediaTypes.find(a=>a.id===p.id);return N?{...p,count:N.count}:p});S.APPS.CAMERA.albums.set(d.albums),S.APPS.CAMERA.mediaTypes.set(v)})})}}]})}}),e(he,{onClick:()=>{s.length!==0&&H.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{x.set({images:s,onSelect:i=>{I("Camera",{action:"addToAlbum",album:i.id,ids:s.map(d=>d.id)}).then(d=>{if(!d)return h("error","Could not add to album, server returned false");n([]),w.set(!1),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(v=>v.id===i.id?{...v,count:v.count+s.length,photoCount:v.photoCount+s.filter(p=>!p.isVideo).length,videoCount:v.videoCount+s.filter(p=>p.isVideo).length,cover:s[s.length-1].src}:v))})}})}},{title:t("APPS.PHOTOS.ADD_TO_FAVOURITES"),cb:()=>{I("Camera",{action:"toggleFavourites",ids:s.map(i=>i.id),favourite:!0}).then(i=>{if(!i)return h("error","Could not add to favourites, server returned false");n([]),w.set(!1),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(d=>d.id==="favourites"?{...d,count:d.count+s.length,photoCount:d.photoCount+s.filter(v=>!v.isVideo).length,videoCount:d.videoCount+s.filter(v=>v.isVideo).length,cover:s[s.length-1].src}:d))})}}]})}})]})]})]})}function He(){var m,g,T;const o=_(x),s=_(S.APPS.CAMERA.albums);let n=(m=o==null?void 0:o.images)==null?void 0:m[(o==null?void 0:o.images.length)-1];return A(G.div,{initial:{opacity:0,scale:.9,y:250},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:250},className:"addtoalbum-container",children:[A("div",{className:"addtoalbum-header",children:[e("div",{}),e("div",{className:"title",children:t("APPS.PHOTOS.ADD_TO_ALBUM")}),e("div",{className:"cancel",onClick:()=>x.reset(),children:t("APPS.PHOTOS.CANCEL")})]}),A("div",{className:"addtoalbum-content",children:[A("div",{className:"preview",children:[q(n==null?void 0:n.src)?e(X,{src:n==null?void 0:n.src,showAdvanced:!1}):e("img",{src:n==null?void 0:n.src}),e("div",{className:"title",children:t("APPS.PHOTOS.SELECTED_COUNT").format({count:(g=o==null?void 0:o.images)==null?void 0:g.length})})]}),e("div",{className:"albums",children:(T=s==null?void 0:s.filter(M=>M.id!=="favourites"&&M.id!=="recents"))==null?void 0:T.map((M,y)=>A("div",{className:"album",onClick:()=>{o.onSelect(M),x.reset()},children:[e("div",{className:"cover",children:q(M.cover)?e(X,{src:M.cover,showAdvanced:!1}):e("img",{src:M.cover??"https://join.travelmanagers.com.au/wp-content/uploads/2017/09/default-placeholder-300x300.png"})}),e("div",{className:"title",children:M.title}),e("div",{className:"count",children:M.count})]},y))})]})]})}function ye(){const o=_(Z),[s,n]=E.useState([{icon:e(Se,{}),title:t("APPS.PHOTOS.LIBRARY"),value:"library"},{icon:e(Oe,{}),title:t("APPS.PHOTOS.ALBUMS"),value:"albums"}]);return e("div",{className:"photos-footer",children:s.map((m,g)=>A("div",{className:"item","data-active":o===m.value,onClick:()=>{Z.set(m.value),m.value==="albums"&&o==="albums"&&(U!=null&&U.value)&&U.reset()},children:[m.icon,m.title]},g))})}const _e=()=>{var v,p,N;const o=_(re),s=_(ae.Settings),[n,m]=E.useState(!0),[g,T]=E.useState(!1),[M,y]=E.useState(0),L=E.useRef(null),B=E.useRef(null),P=_(V),[u,b]=E.useState(new Date(((p=(v=V==null?void 0:V.value)==null?void 0:v.activeImage)==null?void 0:p.timestamp)??0/1e3)),[C,R]=E.useState(((N=P==null?void 0:P.activeImage)==null?void 0:N.favourite)??!1),[O,c]=E.useState([]);let r=(P==null?void 0:P.images)??[];E.useEffect(()=>{if(!(P!=null&&P.activeImage))return h("warning","No active image when changing volume");if(P.activeImage.isVideo){const a=document.getElementById(P.activeImage.id);if(!a)return;a.volume=s.sound.volume}},[s.sound.volume]),E.useEffect(()=>{var l;if(!P)return;let a=r.findIndex(f=>f.id===P.activeImage.id);if(y(a),R(P.activeImage.favourite),P.activeImage.isVideo){const f=document.getElementById(P.activeImage.id);if(!f)return h("warning","Video Element not found (Carousel effect)");f.play(),f.volume=s.sound.volume}if(r.length>0){let f=[];a===0?f=r.slice(0,12):a===r.length-1?f=r.slice(r.length-12,r.length):a<6?f=r.slice(0,12):a>r.length-6?f=r.slice(r.length-12,r.length):f=r.slice(a-6,a+6),b(new Date(((l=r==null?void 0:r[a])==null?void 0:l.timestamp)/1e3)),c(f)}},[P==null?void 0:P.activeImage]);const i={pos:{startLeft:0,startX:0},onMouseDown:a=>{i.pos={startLeft:L.current.scrollLeft,startX:a.clientX},L.current.style.userSelect="none",document.addEventListener("mouseup",i.onMouseUp),document.addEventListener("mousemove",i.onMove),T(!0)},onMove:a=>{if(!L.current)return;const l=(a.clientX-i.pos.startX)/Q();L.current.scrollLeft=i.pos.startLeft-l;const f=L.current.getBoundingClientRect();(f.left*Q()-5>a.clientX||a.clientX>f.right*Q()-5)&&i.onMouseUp()},onMouseUp:()=>{if(!L.current)return;L.current.style.removeProperty("user-select"),document.removeEventListener("mouseup",i.onMouseUp),document.removeEventListener("mousemove",i.onMove);const a=L.current.clientWidth;let l=M;const f=L.current.scrollLeft-i.pos.startLeft;if(f>a/2&&l<r.length?l++:f<-a/2&&l>0&&l--,P.activeImage.id!==r[l].id&&P.activeImage.isVideo){const k=document.getElementById(P.activeImage.id);k&&(k.pause(),k.currentTime=0)}V.set({activeImage:r[l],images:r}),document.getElementById(r[l].id).scrollIntoView({behavior:"smooth",block:"center"}),T(!1)}},d=a=>{P.activeImage.isVideo&&document.getElementById(P.activeImage.id).pause(),V.set({activeImage:a,images:r}),document.getElementById(a.id).scrollIntoView({behavior:"smooth",block:"center"})};return A(G.div,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.5},className:"activephoto-container",children:[e(z,{children:n&&A(G.div,{className:"photo-top",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[e("div",{className:"back",onClick:()=>{H.Share.reset(),V.reset()},children:e(ne,{})}),A("div",{className:"date",children:[u.toLocaleString([],{day:"2-digit",month:"long"}),e("span",{children:u.toLocaleTimeString(o.DateLocale,{hour:"numeric",minute:"numeric",hour12:s.time.twelveHourClock})})]}),e("div",{children:e(se,{onClick:()=>{H.ContextMenu.set({buttons:[{title:t("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{x.set({images:[P.activeImage],onSelect:a=>{I("Camera",{action:"addToAlbum",album:a.id,ids:[P.activeImage.id]}).then(l=>{if(!l)return h("error","Could not add to album, server returned false");S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(f=>f.id===a.id?{...f,count:f.count+1,photoCount:P.activeImage.isVideo?f.photoCount:f.photoCount+1,videoCount:P.activeImage.isVideo?f.videoCount+1:f.videoCount,cover:P.activeImage.src}:f))})}})}},{title:t("APPS.PHOTOS.ADD_TO_FAVOURITES"),cb:()=>{I("Camera",{action:"toggleFavourites",ids:[P.activeImage.id],favourite:!0}).then(a=>{if(!a)return h("error","Could not add to favourites, server returned false");S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(l=>l.id==="favourites"?{...l,count:l.count+1,photoCount:P.activeImage.isVideo?l.photoCount:l.photoCount+1,videoCount:P.activeImage.isVideo?l.videoCount+1:l.videoCount,cover:P.activeImage.src}:l))})}}]})}})})]})}),e("div",{className:"image-overflow",ref:L,onMouseDown:i.onMouseDown,onClick:()=>{g||m(!n)},children:r==null?void 0:r.map((a,l)=>{const f=a.id===P.activeImage.id;return a.isVideo?e("video",{id:a.id,src:a.src,className:f?"active":null,crossOrigin:"anonymous",loop:!0,onLoadedMetadata:D=>{f&&(D.target.scrollIntoView({block:"center"}),D.target.play())}},l):e(be,{id:a.id,src:a.src,className:f?"active":null,ignoreStreamerMode:!0,onLoad:D=>{f&&D.target.scrollIntoView({block:"center"})}},l)})}),e(z,{children:n&&A(G.div,{className:"photo-bottom-wrapper",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[e("div",{className:"photo-carousel",ref:B,children:O.map((a,l)=>a.isVideo?e("video",{src:a.src,"data-carousel":l,controls:!1,muted:!0,onClick:f=>d(a)},l):e("img",{src:a.src,"data-carousel":l,onClick:f=>d(a)},l))}),A("div",{className:"photo-bottom",children:[e(ee,{onClick:()=>{H.Share.set({type:"image",data:{src:P.activeImage.src,isVideo:P.activeImage.isVideo}})}}),e("div",{onClick:()=>{I("Camera",{action:"toggleFavourites",ids:[P.activeImage.id],favourite:!C}).then(a=>{if(!a)return h("warning","Failed to toggle favourite, server returned success false");R(!C),S.APPS.CAMERA.albums.set(S.APPS.CAMERA.albums.value.map(l=>l.id==="favourites"?{...l,count:C?l.count-1:l.count+1,photoCount:P.activeImage.isVideo?l.photoCount:C?l.photoCount-1:l.photoCount+1,videoCount:P.activeImage.isVideo?C?l.videoCount-1:l.videoCount+1:l.videoCount,cover:P.activeImage.src}:l))})},children:C?e(oe,{}):e(Ee,{})}),e(te,{onClick:()=>{H.PopUp.set({title:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.TITLE"),description:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.DESCRIPTION"),buttons:[{title:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.CANCEL")},{title:t("APPS.PHOTOS.DELETE_IMAGE_POPUP.PROCEED"),color:"red",cb:()=>{I("Camera",{action:"deleteFromGallery",ids:[P.activeImage.id]}).then(a=>{if(!a)return h("error","Could not delete from gallery, server returned false");V.reset(),I("Camera",{action:"getAlbums"}).then(l=>{if(!l)return h("error","No data received from server");let f=Y.map(D=>{const k=l.mediaTypes.find(W=>W.id===D.id);return k?{...D,count:k.count}:D});S.APPS.CAMERA.albums.set(l.albums),S.APPS.CAMERA.mediaTypes.set(f)})})}}]})}})]})]})})]})};const Z=$("albums"),w=$(!1),V=$(null),x=$(null),Ue={library:e(Re,{}),albums:e(Ne,{})},De=[2,3,4,5];function Fe(){const o=_(Z),s=_(V),n=_(w),m=_(x),g=_(ae.PhoneNumber);return E.useEffect(()=>{V.reset(),w.reset(),x.reset()},[g]),A("div",{className:"photos-container",children:[e("div",{className:"photos-content",style:{pointerEvents:s?"none":"all"},children:Ue[o]}),!n&&e(ye,{}),e(z,{children:s&&e(_e,{})}),e(z,{children:m&&e(He,{})})]})}export{V as ActiveImage,x as AlbumPickerComponent,w as SelectMode,Z as View,Fe as default,De as zoomLevels};
