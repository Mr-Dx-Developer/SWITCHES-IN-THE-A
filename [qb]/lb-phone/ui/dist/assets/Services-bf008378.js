import{r as P,j as e,a as i,F as W}from"./jsx-runtime-f40812bf.js";import{f as v,L as t,C as g,d as j,g as y,u as q,j as D,I as J,b as T,t as K,A as H,D as _,e as B,k as z}from"./Phone-6f7ce284.js";import{u as b,a0 as Q,b4 as Z,aW as k,X as ee,aj as te,aG as Y,b5 as ae,j as ne,b6 as F,am as G,n as ie,b7 as se}from"./index.esm-3d32a72b.js";import{r as x}from"./number-28525126.js";function ce(){var N,h,u,O,p,l,m,n,E;const s=b(y),[a,d]=P.useState(null),[A,o]=P.useState(null);return P.useEffect(()=>{v("Services",{action:"getCompany"}).then(c=>{c&&d(c)})},[]),e("div",{className:"animation-slide right",children:a!=null&&a.job?i("div",{className:"actions-container",children:[a.duty!==void 0&&((h=(N=s==null?void 0:s.Companies)==null?void 0:N.Management)==null?void 0:h.Duty)!==!1&&i("section",{children:[e("div",{className:"title",children:t("APPS.SERVICES.DUTY")}),e("div",{className:"content","data-clickable":"true",onClick:()=>{v("Services",{action:"toggleDuty",duty:!a.duty}).then(()=>d({...a,duty:!a.duty}))},children:e("div",{className:"item single",children:e("div",{className:"value",children:a.duty?t("APPS.SERVICES.GO_OFF_DUTY"):t("APPS.SERVICES.GO_ON_DUTY")})})})]}),(a.duty===void 0||a.duty===!0)&&i("section",{children:[e("div",{className:"title",children:t("APPS.SERVICES.JOB_CALLS")}),e("div",{className:"content","data-clickable":"true",onClick:()=>{v("Services",{action:"toggleCalls"}).then(c=>{d({...a,receiveCalls:c})})},children:e("div",{className:"item single",children:e("div",{className:"value",children:a.receiveCalls?t("APPS.SERVICES.DISABLE_CALLS"):t("APPS.SERVICES.ENABLE_CALLS")})})})]}),a.isBoss&&i(W,{children:[i("section",{children:[e("div",{className:"title",children:t("APPS.SERVICES.ACTIONS")}),i("div",{className:"content",children:[i("div",{className:"item",children:[e("div",{className:"title",children:t("APPS.SERVICES.BALANCE")}),e("div",{className:"value",children:s.CurrencyFormat.replace("%s",(u=a.balance)==null?void 0:u.toString())})]}),i("div",{className:"row",children:[((p=(O=s==null?void 0:s.Companies)==null?void 0:O.Management)==null?void 0:p.Deposit)!==!1&&i("div",{className:"item","data-col":2,onClick:()=>{g.PopUp.set({title:t("APPS.SERVICES.DEPOSIT_POPUP.TITLE"),description:t("APPS.SERVICES.DEPOSIT_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.SERVICES.DEPOSIT_POPUP.AMOUNT"),onChange:c=>{o(c)},type:"number"},buttons:[{title:t("APPS.SERVICES.DEPOSIT_POPUP.CANCEL")},{title:t("APPS.SERVICES.DEPOSIT_POPUP.PROCEED"),cb:()=>{o(c=>{/^\d+$/.test(c)&&v("Services",{action:"depositMoney",amount:parseInt(c)}).then(S=>{if(typeof S!="number")return j("warning","Balance is not a number, not updating");d({...a,balance:S})})})}}]})},children:[e("div",{className:"title"}),e("div",{className:"value",children:t("APPS.SERVICES.DEPOSIT_POPUP.TITLE")})]}),((m=(l=s==null?void 0:s.Companies)==null?void 0:l.Management)==null?void 0:m.Withdraw)!==!1&&i("div",{className:"item","data-col":2,onClick:()=>{g.PopUp.set({title:t("APPS.SERVICES.WITHDRAW_POPUP.TITLE"),description:t("APPS.SERVICES.WITHDRAW_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.SERVICES.WITHDRAW_POPUP.AMOUNT"),onChange:c=>{o(c)},type:"number"},buttons:[{title:t("APPS.SERVICES.WITHDRAW_POPUP.CANCEL")},{title:t("APPS.SERVICES.WITHDRAW_POPUP.PROCEED"),cb:()=>{o(c=>{/^\d+$/.test(c)&&v("Services",{action:"withdrawMoney",amount:parseInt(c)}).then(S=>{if(typeof S!="number")return j("warning","Balance is not a number, not updating");d({...a,balance:S})})})}}]})},children:[e("div",{className:"title"}),e("div",{className:"value",children:t("APPS.SERVICES.WITHDRAW_POPUP.TITLE")})]})]})]})]}),i("section",{children:[e("div",{className:"title",children:t("APPS.SERVICES.MANAGE_EMPLOYEES")}),i("div",{className:"content","data-clickable":s.Companies.Management.Fire!==!1||s.Companies.Management.Promote!==!1||s.Companies.Management.Hire!==!1,children:[((E=(n=s==null?void 0:s.Companies)==null?void 0:n.Management)==null?void 0:E.Hire)!==!1&&e("div",{className:"item single",onClick:()=>{g.PopUp.set({title:t("APPS.SERVICES.HIRE_POPUP.TITLE"),description:t("APPS.SERVICES.HIRE_POPUP.DESCRIPTION"),input:{type:"number",placeholder:t("APPS.SERVICES.HIRE_POPUP.PLACEHOLDER"),onChange:c=>{o(c)}},buttons:[{title:t("APPS.SERVICES.HIRE_POPUP.CANCEL")},{title:t("APPS.SERVICES.HIRE_POPUP.PROCEED"),cb:()=>{o(c=>{if(/^\d+$/.test(c))return v("Services",{action:"hireEmployee",source:parseInt(c)}).then(S=>{S&&d({...a,employees:[...a.employees,{id:S.id,name:S.name,grade:0,gradeLabel:a.grades[0].label,canInteract:!0}]})}),""})}}]})},children:e("div",{className:"value",children:t("APPS.SERVICES.HIRE")})}),a.employees.map((c,S)=>i("div",{className:"item",onClick:()=>{if(!c.canInteract||s.Companies.Management.Fire===!1&&s.Companies.Management.Promote===!1)return;const R=[s.Companies.Management.Promote!==!1&&{title:t("APPS.SERVICES.SET_GRADE"),cb:()=>{setTimeout(()=>{g.ContextMenu.set({buttons:[...a.grades.map((C,U)=>({title:C.label,cb:()=>{v("Services",{action:"setGrade",employee:c.id,grade:C.grade}).then(L=>{L&&d({...a,employees:a.employees.map(M=>(M.id===c.id&&(M.grade=C.grade,M.gradeLabel=C.label),M))})})}}))]})},300)}},s.Companies.Management.Fire!==!1&&{title:t("APPS.SERVICES.FIRE_POPUP.TITLE"),color:"red",cb:()=>{g.PopUp.set({title:t("APPS.SERVICES.FIRE_POPUP.TITLE"),description:t("APPS.SERVICES.FIRE_POPUP.DESCRIPTION").format({name:c.name}),buttons:[{title:t("APPS.SERVICES.FIRE_POPUP.CANCEL")},{title:t("APPS.SERVICES.FIRE_POPUP.PROCEED"),color:"red",cb:()=>{v("Services",{action:"fireEmployee",employee:c.id}).then(()=>{d({...a,employees:a.employees.filter(C=>C.id!==c.id)})})}}]})}}];g.ContextMenu.set({buttons:R.filter(C=>C)})},children:[e("div",{className:"title",children:c.gradeLabel}),e("div",{className:"value",children:c.name})]},S))]})]})]})]}):e("div",{className:"no-job",children:t("APPS.SERVICES.UNEMPLOYED")})})}function le(){const{View:s,Data:a}=P.useContext(V),d=b(T.Settings),A=b(T.PhoneNumber),[o,N]=a,[h,u]=s,[O,p]=P.useState(0),[l,m]=P.useState(!1),[n,E]=P.useState(!1),[c,S]=P.useState([]),R=P.useRef(null),[C,U]=P.useState({content:"",attachments:[]});P.useEffect(()=>{v("Services",{action:"getMessages",page:0,id:o.id,company:o.job}).then(r=>{if(r&&r.length>0){S([...r.reverse()]);let I=document.querySelector(".chat-container");I.scrollTop=I.scrollHeight}else m(!0)})},[]);const L=()=>{if(C.content.length>0){let r={sender:A,id:o.id,company:o.job,content:C.content,timestamp:new Date};if(d.airplaneMode)return S(I=>[...I,{...r,delivered:!1}]);v("Services",{action:"sendMessage",...r}).then(I=>{S(I?f=>[...f,r]:f=>[...f,{...r,delivered:!1}]),U({content:"",attachments:[]}),R.current.value=""})}},M=()=>{g.PopUp.set({title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:t("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{v("Maps",{action:"getCurrentLocation"}).then(r=>{if(!r)return;let I={sender:A,content:`<!SENT-LOCATION-X=${x(r.x,2)}Y=${x(r.y,2)}!>`,attachments:[],id:o.id,company:o.job,timestamp:new Date};v("Services",{action:"sendMessage",...I}).then(f=>{S(f?w=>[...w,I]:w=>[...w,{...I,delivered:!1}])})})}}]})},$=()=>{if(l||n)return;let r=document.querySelector("#last");if(!r)return;!K(r)&&(E(!0),v("Services",{action:"getMessages",page:O+1,id:o.id,company:o.job}).then(f=>{f&&f.length>0?(S([...f.reverse(),...c]),E(!1),f.length<25&&m(!0)):m(!0)}),p(f=>f+1))};q("services:newMessage",r=>{if(o.id!==r.channelId||r.sender===A||d.airplaneMode)return;S([...c,{...r,timestamp:new Date}]);let I=document.querySelector(".chat-container");I.scrollTop=I.scrollHeight});const X=r=>{if(r)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(r)};return e(W,{children:i("div",{className:"animation-slide left",children:[i("div",{className:"chat-header",children:[e("div",{className:"back",onClick:()=>{u("messages"),N(null)},children:e(Q,{})}),i("div",{className:"user",children:[e("img",{src:o.icon??"./assets/img/no-pfp.png",className:"avatar"}),e("div",{className:"name",children:o.company??D(o.number)})]}),e(Z,{className:"hidden"})]}),e("div",{className:"chat-container",onScroll:$,children:e("div",{className:"chat-body",children:c.map((r,I)=>e(oe,{index:I,messages:c,message:r,func:{isLocation:X}}))})}),i("div",{className:"chat-bottom",children:[e(k,{onClick:M}),i("div",{className:"input",children:[e(J,{placeholder:t("APPS.MESSAGES.PLACEHOLDER"),ref:R,value:C.content,onChange:r=>{U({content:r.target.value,attachments:C.attachments})},onKeyDown:r=>{r.key=="Enter"&&L()}}),C.content.length>0&&e("div",{className:"send",onClick:L,children:e(ee,{})})]})]})]})})}const oe=({messages:s,message:a,index:d,func:A})=>{var E;const{Data:o}=P.useContext(V);b(T.Settings);const N=b(T.PhoneNumber),[h]=o;let u,O,p,l=d===0?"last":"",m=a.sender===N?"self":"other",n=((E=s[d+1])==null?void 0:E.sender)===N?"self":"other";if(s[d+1]?O=Math.abs(a.timestamp-s[d+1].timestamp)/36e5:n=void 0,A.isLocation(a.content)){let c=a.content.match(/X=(-?\d*\.?\d*)Y/)[1],S=a.content.match(/Y=(-?\d*\.?\d*)!>/)[1];p={x:c,y:S}}return i("div",{className:`message ${m}`,id:l,"data-id":a.id,children:[u,a.delivered===!1?i("div",{className:"content-wrapper",children:[e("div",{className:"content",children:H(a.content)}),e(te,{})]}):p?i("div",{className:"location",onClick:()=>{T.App.set({name:"Maps",data:{location:[p.y,p.x],name:`${D(a.sender)}'s location`,icon:h.icon}})},children:[e("div",{className:"img",style:{backgroundImage:'url("https://img.gta5-mods.com/q95/images/mirror-park-garden/2b72f9-20160428154103_1.jpg")'}}),m==="other"&&i("div",{className:"sender",children:[D(a.sender)," ",t("APPS.MESSAGES.SENT_LOCATION")]})]}):a.content&&e("div",{className:"content",children:H(a.content)}),a.delivered===!1?e("div",{className:"status",children:t("APPS.MESSAGES.NOT_DELIVERED")}):s[d+1]&&O>6?e("div",{className:"date",children:_(a.timestamp)}):m!==n&&e("div",{className:"date",children:_(a.timestamp)})]},d)};function re(){const{View:s,Data:a}=P.useContext(V),[d,A]=s,[o,N]=a,h=b(y),[u,O]=P.useState([]);P.useEffect(()=>{v("Services",{action:"getCompanies"}).then(n=>{n&&O(n)})},[]);const p=n=>{var E;!((E=n==null?void 0:n.location)!=null&&E.coords)||!n.name||T.App.set({name:"Maps",data:{location:[n.location.coords.y,n.location.coords.x],name:n.name,icon:n.icon}})},l=(n,E)=>{h.Companies.Enabled&&g.PopUp.set({title:t("APPS.SERVICES.CALL_POPUP.TITLE"),description:t("APPS.SERVICES.CALL_POPUP.DESCRIPTION").format({name:B(n)}),buttons:[{title:t("APPS.SERVICES.CALL_POPUP.CANCEL")},{title:t("APPS.SERVICES.CALL_POPUP.PROCEED"),cb:()=>{z({company:n,companylabel:E})}}]})},m=n=>{v("Services",{action:"getChannelId",company:n.job}).then(E=>{E&&(N({icon:n.icon,company:n.name,job:n.job,id:E}),A("chat"))})};return e("div",{className:"animation-slide right",children:e("div",{className:"companies-list",children:u.sort((n,E)=>n.open&&!E.open?-1:!n.open&&E.open?1:0).map((n,E)=>{var c,S,R,C;return i("div",{className:"item","data-open":n.open,children:[i("div",{className:"info",children:[n.icon&&e("div",{className:"icon",children:e("img",{src:n.icon})}),i("div",{className:"company-details",children:[e("div",{className:"title",children:n.name}),i("div",{className:"location",children:[e(Y,{}),(c=n.location)==null?void 0:c.name]})]})]}),n.open?i("div",{className:"actions",children:[n.customIcon&&e("div",{className:"custom-icon",onClick:()=>v("Services",{action:"customIconClick",company:n.job}),children:ae[n.customIcon]()}),((S=n.location)==null?void 0:S.coords)&&e(k,{onClick:()=>p(n)}),((R=h.Companies)==null?void 0:R.Enabled)!==!1&&n.canCall!==!1&&e(ne,{onClick:()=>l(n.job,n.name)}),n.canMessage!==!1&&e(F,{onClick:()=>m(n)})]}):i("div",{className:"actions",children:[((C=n.location)==null?void 0:C.coords)&&e(k,{onClick:()=>p(n)}),n.canMessage!==!1&&h.Companies.MessageOffline&&e(F,{onClick:()=>m(n)}),t("APPS.SERVICES.CLOSED")]})]},E)})})})}function de(){const{View:s,Data:a}=P.useContext(V),d=b(T.PhoneNumber),[A,o]=s,[N,h]=a,[u,O]=P.useState({personal:[],job:[]});P.useEffect(()=>{v("Services",{action:"getRecentMessages",page:0}).then(l=>{l&&O({personal:[...l.filter(m=>m.number===d)],job:[...l.filter(m=>m.number!==d)]})})},[]);const p=l=>{if(l)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(l)};return e("div",{className:"animation-slide right",children:i("div",{className:"company-messages-container",children:[i("section",{children:[e("div",{className:"title",children:t("APPS.SERVICES.YOUR_MESSAGES")}),e("div",{className:"content",children:u.personal&&u.personal.map((l,m)=>i("div",{className:"item",onClick:()=>{h({...N,icon:l.company.icon,company:l.company.name,job:l.company.job,id:l.id}),o("chat")},children:[e("img",{src:l.company.icon}),i("div",{className:"info",children:[i("div",{className:"info-header",children:[e("div",{className:"user",children:B(l.company.name)}),i("div",{className:"right",children:[e("div",{className:"time",children:_(l.timestamp)}),e(G,{})]})]}),e("div",{className:"message",children:p(l.lastMessage)?t("APPS.MESSAGES.SENT_LOCATION_SHORT"):l.lastMessage})]})]},m))})]}),i("section",{children:[e("div",{className:"title",children:t("APPS.SERVICES.JOB_MESSAGES")}),e("div",{className:"content",children:u.job&&u.job.map((l,m)=>i("div",{className:"item",onClick:()=>{h({...N,id:l.id,icon:"./assets/img/no-pfp.png",number:l.number}),o("chat")},children:[e("img",{src:"./assets/img/no-pfp.png"}),i("div",{className:"info",children:[i("div",{className:"info-header",children:[e("div",{className:"user",children:D(l.number)}),i("div",{className:"right",children:[e("div",{className:"time",children:_(l.timestamp)}),e(G,{})]})]}),e("div",{className:"message",children:p(l.lastMessage)?t("APPS.MESSAGES.SENT_LOCATION_SHORT"):l.lastMessage})]})]},m+100))})]})]})})}function Se(){const{View:s}=P.useContext(V),a=b(y),[d,A]=s,[o,N]=P.useState([{icon:e(Y,{}),title:t("APPS.SERVICES.COMPANIES"),value:"companies"},{icon:e(ie,{}),title:t("APPS.SERVICES.MESSAGES"),value:"messages"}]);return P.useEffect(()=>{var h,u;((u=(h=a==null?void 0:a.Companies)==null?void 0:h.Management)==null?void 0:u.Enabled)!==!1&&N([...o,{icon:e(se,{}),title:t("APPS.SERVICES.ACTIONS"),value:"actions"}])},[]),e("div",{className:"companies-footer",children:o.map((h,u)=>i("div",{className:"item","data-active":d===h.value,onClick:()=>A(h.value),children:[h.icon,h.title]},u))})}const V=P.createContext(null);function ue(){const[s,a]=P.useState("companies"),[d,A]=P.useState(null),o={companies:e(re,{}),actions:e(ce,{}),messages:e(de,{}),chat:e(le,{})};let N={actions:t("APPS.SERVICES.ACTIONS"),messages:t("APPS.SERVICES.MESSAGES"),companies:t("APPS.SERVICES.COMPANIES")};return e(V.Provider,{value:{View:[s,a],Data:[d,A]},children:i("div",{className:"companies-container",children:[s!=="chat"&&e("div",{className:"companies-header",children:e("div",{className:"title",children:N[s]})}),e("div",{className:"companies-body",children:o[s]}),s!=="chat"&&e(Se,{})]})})}export{V as ServicesContext,ue as default};
