import{r as t,a as s,j as a,F as S}from"./jsx-runtime-f40812bf.js";import{f as P,u as x,d as L,F as R,L as n,C as F,I as y,k as T,E as U,b as D,h as k}from"./Phone-3c5ec2e3.js";import{u as b,A as B,m as $,aI as X}from"./index.esm-497ba86e.js";import{r as v,f as g}from"./number-28525126.js";import{N as j}from"./Numpad-cc7ba39c.js";function J(){const h=b(D.Settings),d=b(k),[l,E]=t.useState({balance:0,transactions:[],bills:[]}),[N,c]=t.useState(!1),[C,I]=t.useState(""),[i,p]=t.useState(0),[_,A]=t.useState(!1),[r,o]=t.useState(""),[f,m]=t.useState(null);t.useEffect(()=>{P("Wallet",{action:"getData"}).then(e=>{e&&E(e)})},[]),t.useEffect(()=>{o(""),p(0)},[N]),x("wallet:addTransaction",e=>{h.airplaneMode||E({...l,balance:l.balance+e.amount,transactions:[e,...l.transactions].slice(0,5)})}),t.useEffect(()=>{i===0?r.length>3?A(!0):A(!1):i===1&&(r.length>0&&W(parseFloat(r))&&parseFloat(r)<=(d.MaxTransferAmount??Number.MAX_SAFE_INTEGER)?A(!0):A(!1))},[r]);const W=e=>(L("info",`Can afford? ${l.balance>=e} Balance: ${l.balance}, amount: ${e}`),l.balance>=e),w=e=>{if(e=="backspace")return o(u=>u.length>0?u.slice(0,-1):"0");o(u=>u+e)};return t.useEffect(()=>{if(i!==1||r.length>=9)return;const e=document.getElementById("number");e.style.width=`${r.length}ch`,f&&m(null)},[r]),t.useEffect(()=>{m(null)},[i]),s("div",{className:"wallet-app-container",children:[a(B,{children:N&&s($.div,{...R,className:"send-container",children:[s("div",{className:"send-header",children:[a("div",{onClick:()=>c(!1),children:n("CANCEL")}),i===2?a("div",{onClick:()=>c(!1),children:n("APPS.WALLET.DONE")}):a("div",{className:!_&&"disabled",onClick:()=>{if(_){if(i==0)P("Wallet",{action:"doesNumberExist",number:r}).then(e=>{e?(I(r),p(1),o("")):m(n("APPS.WALLET.NUMBER_DOES_NOT_EXIST"))});else if(i==1){if(!W(parseFloat(r)))return m(n("APPS.WALLET.NOT_ENOUGH_MONEY"));if(parseFloat(r)>(d.MaxTransferAmount??Number.MAX_SAFE_INTEGER))return m("Max transfer amount reached");if(h.airplaneMode){F.PopUp.set({title:n("MISC.AIRPLANE_MODE_POPUP.TITLE"),description:n("MISC.AIRPLANE_MODE_POPUP.DESCRIPTION"),buttons:[{title:n("MISC.AIRPLANE_MODE_POPUP.OK")}]});return}P("Wallet",{action:"sendPayment",number:C,amount:Math.floor(parseFloat(r))}).then(e=>{e!=null&&e.success?p(2):(L("warning","not success",e.reason),m(e.reason))})}}},children:n("APPS.WALLET.NEXT")})]}),s("div",{className:"send-wrapper",children:[i===0&&s(S,{children:[a("div",{className:"user",children:a(y,{className:"number_input",type:"number",onChange:e=>o(e.target.value.replace(/[^0-9]/g,"")),value:r,placeholder:T("1234567890")})}),a("div",{className:"button",onClick:()=>{F.ContactSelector.set({onSelect:e=>{if(!(e!=null&&e.number))return L("warning","No contact found");P("Wallet",{action:"doesNumberExist",number:e.number}).then(u=>{u?(I(e.number),p(1),o("")):m(n("APPS.WALLET.NUMBER_DOES_NOT_EXIST"))})}})},children:n("APPS.WALLET.SELECT_CONTACT")}),a("div",{className:"description",children:n("APPS.WALLET.NO_REFUNDS")}),f&&a("div",{className:"error",children:f})]}),i===1&&s(S,{children:[s("div",{className:"amount",children:[a("div",{className:"symbol",children:d.CurrencyFormat.replace("%s","")}),a(y,{type:"number",id:"number",value:r,onChange:e=>o(e.target.value.replace(/[^0-9]/g,""))})]}),s("div",{className:"description",children:[n("APPS.WALLET.NEW_BALANCE"),": ",d.CurrencyFormat.replace("%s",""),isNaN(v(l.balance-parseFloat(r),2))?l.balance:v(l.balance-parseFloat(r),2)]}),f&&a("div",{className:"error",children:f})]}),i===2&&s("div",{className:"success",children:[a(X,{}),a("div",{className:"title",children:n("APPS.WALLET.DONE")}),a("div",{className:"subtitle",children:n("APPS.WALLET.DONE_SUBTITLE").format({amount:d.CurrencyFormat.replace("%s",r),number:T(C)})})]})]}),i!==2&&a("div",{className:"numpad-wrapper",children:a(j,{cb:e=>w(e)})})]})}),s("div",{className:"overview",children:[a("div",{className:"header-title",children:n("APPS.WALLET.TITLE")}),s("div",{className:"wrapper",children:[a("div",{className:"card"}),a("section",{children:s("div",{className:"item space",children:[s("div",{className:"balance",children:[a("div",{className:"title",children:n("APPS.WALLET.BALANCE")}),a(G,{amount:l.balance})]}),a("div",{className:"button",onClick:()=>c(!0),children:n("APPS.WALLET.SEND")})]})}),l.transactions&&l.transactions.length>0&&s(S,{children:[a("div",{className:"subtitle",children:a("div",{className:"title",children:n("APPS.WALLET.LATEST_TRANSACTIONS")})}),a("section",{children:l.transactions.map((e,u)=>{let O=e.amount>0,M=e.company.match(/\d{10}/);return s("div",{className:"item multi",children:[e.logo?a("img",{src:e.logo}):!M&&a("div",{className:"image",children:e.company[0]}),s("div",{className:"info",children:[s("div",{className:"transaction-header",children:[a("div",{className:"title",children:M?T(e.company):e.company}),a("div",{className:"right",children:s("div",{className:`amount ${O?"green":"red"}`,children:[!O&&"-",d.CurrencyFormat.replace("%s",g(Math.abs(e.amount)))]})})]}),a("div",{className:"date",children:U(e.timestamp)})]})]})})})]}),l.bills&&l.bills.length>0&&s(S,{children:[a("div",{className:"subtitle",children:a("div",{className:"title",children:n("APPS.WALLET.LATEST_BILLS")})}),a("section",{})]})]})]})]})}const G=({amount:h})=>{const d=b(k),[l,E]=t.useState(!0),N=b(D.Settings);let c;return l&&(N!=null&&N.streamerMode)?c=g(parseInt("⁎".repeat(v(h,2).toString().length))):c=g(v(h,2)),c.length>15&&(c=c.slice(0,15)+"..."),a("div",{className:"value",onClick:()=>E(!l),children:d.CurrencyFormat.replace("%s",c)})};export{J as default};
