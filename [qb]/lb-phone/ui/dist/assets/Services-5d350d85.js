import{r as P,j as e,a as i,F as W}from"./jsx-runtime-f40812bf.js";import{f as v,L as t,C as g,d as j,h as y,u as B,k as D,I as J,b as T,v as K,B as H,E as _,e as Y,m as Q}from"./Phone-3c5ec2e3.js";import{u as R,a as Z,bd as z,b4 as w,Z as ee,ak as te,aQ as $,be as ne,l as ae,bf as F,an as G,p as ie,bg as se}from"./index.esm-497ba86e.js";import{r as x}from"./number-28525126.js";function ce(){var N,u,C,f,p,l,E,n,m;const c=R(y),[a,S]=P.useState(null),[A,o]=P.useState(null);return P.useEffect(()=>{v("Services",{action:"getCompany"}).then(s=>{s&&S(s)})},[]),e("div",{className:"animation-slide right",children:a!=null&&a.job?i("div",{className:"actions-container",children:[a.duty!==void 0&&((u=(N=c==null?void 0:c.Companies)==null?void 0:N.Management)==null?void 0:u.Duty)!==!1&&i("section",{children:[e("div",{className:"title",children:t("APPS.SERVICES.DUTY")}),e("div",{className:"content","data-clickable":"true",onClick:()=>{v("Services",{action:"toggleDuty",duty:!a.duty}).then(()=>S({...a,duty:!a.duty}))},children:e("div",{className:"item single",children:e("div",{className:"value",children:a.duty?t("APPS.SERVICES.GO_OFF_DUTY"):t("APPS.SERVICES.GO_ON_DUTY")})})})]}),(a.duty===void 0||a.duty===!0)&&i("section",{children:[e("div",{className:"title",children:t("APPS.SERVICES.JOB_CALLS")}),e("div",{className:"content","data-clickable":"true",onClick:()=>{v("Services",{action:"toggleCalls"}).then(s=>{S({...a,receiveCalls:s})})},children:e("div",{className:"item single",children:e("div",{className:"value",children:a.receiveCalls?t("APPS.SERVICES.DISABLE_CALLS"):t("APPS.SERVICES.ENABLE_CALLS")})})})]}),a.isBoss&&i(W,{children:[i("section",{children:[e("div",{className:"title",children:t("APPS.SERVICES.ACTIONS")}),i("div",{className:"content",children:[i("div",{className:"item",children:[e("div",{className:"title",children:t("APPS.SERVICES.BALANCE")}),e("div",{className:"value",children:c.CurrencyFormat.replace("%s",(C=a.balance)==null?void 0:C.toString())})]}),i("div",{className:"row",children:[((p=(f=c==null?void 0:c.Companies)==null?void 0:f.Management)==null?void 0:p.Deposit)!==!1&&i("div",{className:"item","data-col":2,onClick:()=>{g.PopUp.set({title:t("APPS.SERVICES.DEPOSIT_POPUP.TITLE"),description:t("APPS.SERVICES.DEPOSIT_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.SERVICES.DEPOSIT_POPUP.AMOUNT"),onChange:s=>{o(s)},type:"number"},buttons:[{title:t("APPS.SERVICES.DEPOSIT_POPUP.CANCEL")},{title:t("APPS.SERVICES.DEPOSIT_POPUP.PROCEED"),cb:()=>{o(s=>{/^\d+$/.test(s)&&v("Services",{action:"depositMoney",amount:parseInt(s)}).then(r=>{if(typeof r!="number")return j("warning","Balance is not a number, not updating");S({...a,balance:r})})})}}]})},children:[e("div",{className:"title"}),e("div",{className:"value",children:t("APPS.SERVICES.DEPOSIT_POPUP.TITLE")})]}),((E=(l=c==null?void 0:c.Companies)==null?void 0:l.Management)==null?void 0:E.Withdraw)!==!1&&i("div",{className:"item","data-col":2,onClick:()=>{g.PopUp.set({title:t("APPS.SERVICES.WITHDRAW_POPUP.TITLE"),description:t("APPS.SERVICES.WITHDRAW_POPUP.DESCRIPTION"),input:{placeholder:t("APPS.SERVICES.WITHDRAW_POPUP.AMOUNT"),onChange:s=>{o(s)},type:"number"},buttons:[{title:t("APPS.SERVICES.WITHDRAW_POPUP.CANCEL")},{title:t("APPS.SERVICES.WITHDRAW_POPUP.PROCEED"),cb:()=>{o(s=>{/^\d+$/.test(s)&&v("Services",{action:"withdrawMoney",amount:parseInt(s)}).then(r=>{if(typeof r!="number")return j("warning","Balance is not a number, not updating");S({...a,balance:r})})})}}]})},children:[e("div",{className:"title"}),e("div",{className:"value",children:t("APPS.SERVICES.WITHDRAW_POPUP.TITLE")})]})]})]})]}),i("section",{children:[e("div",{className:"title",children:t("APPS.SERVICES.MANAGE_EMPLOYEES")}),i("div",{className:"content","data-clickable":c.Companies.Management.Fire!==!1||c.Companies.Management.Promote!==!1||c.Companies.Management.Hire!==!1,children:[((m=(n=c==null?void 0:c.Companies)==null?void 0:n.Management)==null?void 0:m.Hire)!==!1&&e("div",{className:"item single",onClick:()=>{g.PopUp.set({title:t("APPS.SERVICES.HIRE_POPUP.TITLE"),description:t("APPS.SERVICES.HIRE_POPUP.DESCRIPTION"),input:{type:"number",placeholder:t("APPS.SERVICES.HIRE_POPUP.PLACEHOLDER"),onChange:s=>{o(s)}},buttons:[{title:t("APPS.SERVICES.HIRE_POPUP.CANCEL")},{title:t("APPS.SERVICES.HIRE_POPUP.PROCEED"),cb:()=>{o(s=>{if(/^\d+$/.test(s))return v("Services",{action:"hireEmployee",source:parseInt(s)}).then(r=>{r&&S({...a,employees:[...a.employees,{id:r.id,name:r.name,grade:0,gradeLabel:a.grades[0].label,canInteract:!0}]})}),""})}}]})},children:e("div",{className:"value",children:t("APPS.SERVICES.HIRE")})}),a.employees.map((s,r)=>i("div",{className:"item",onClick:()=>{if(!s.canInteract||c.Companies.Management.Fire===!1&&c.Companies.Management.Promote===!1)return;const b=[c.Companies.Management.Promote!==!1&&{title:t("APPS.SERVICES.SET_GRADE"),cb:()=>{setTimeout(()=>{g.ContextMenu.set({buttons:[...a.grades.map((h,U)=>({title:h.label,cb:()=>{v("Services",{action:"setGrade",employee:s.id,grade:h.grade}).then(L=>{L&&S({...a,employees:a.employees.map(M=>(M.id===s.id&&(M.grade=h.grade,M.gradeLabel=h.label),M))})})}}))]})},300)}},c.Companies.Management.Fire!==!1&&{title:t("APPS.SERVICES.FIRE_POPUP.TITLE"),color:"red",cb:()=>{g.PopUp.set({title:t("APPS.SERVICES.FIRE_POPUP.TITLE"),description:t("APPS.SERVICES.FIRE_POPUP.DESCRIPTION").format({name:s.name}),buttons:[{title:t("APPS.SERVICES.FIRE_POPUP.CANCEL")},{title:t("APPS.SERVICES.FIRE_POPUP.PROCEED"),color:"red",cb:()=>{v("Services",{action:"fireEmployee",employee:s.id}).then(()=>{S({...a,employees:a.employees.filter(h=>h.id!==s.id)})})}}]})}}];g.ContextMenu.set({buttons:b.filter(h=>h)})},children:[e("div",{className:"title",children:s.gradeLabel}),e("div",{className:"value",children:s.name})]},r))]})]})]})]}):e("div",{className:"no-job",children:t("APPS.SERVICES.UNEMPLOYED")})})}function le(){const{View:c,Data:a}=P.useContext(V),S=R(T.Settings),A=R(T.PhoneNumber),[o,N]=a,[u,C]=c,[f,p]=P.useState(0),[l,E]=P.useState(!1),[n,m]=P.useState(!1),[s,r]=P.useState([]),b=P.useRef(null),[h,U]=P.useState({content:"",attachments:[]});P.useEffect(()=>{v("Services",{action:"getMessages",page:0,id:o.id,company:o.job}).then(d=>{if(d&&d.length>0){r([...d.reverse()]);let I=document.querySelector(".chat-container");I.scrollTop=I.scrollHeight}else E(!0)})},[]);const L=()=>{if(h.content.length>0){let d={sender:A,id:o.id,company:o.job,content:h.content,timestamp:new Date};if(S.airplaneMode)return r(I=>[...I,{...d,delivered:!1}]);v("Services",{action:"sendMessage",...d}).then(I=>{r(I?O=>[...O,d]:O=>[...O,{...d,delivered:!1}]),U({content:"",attachments:[]}),b.current.value=""})}},M=()=>{g.PopUp.set({title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:t("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:t("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{v("Maps",{action:"getCurrentLocation"}).then(d=>{if(!d)return;let I={sender:A,content:`<!SENT-LOCATION-X=${x(d.x,2)}Y=${x(d.y,2)}!>`,attachments:[],id:o.id,company:o.job,timestamp:new Date};v("Services",{action:"sendMessage",...I}).then(O=>{r(O?k=>[...k,I]:k=>[...k,{...I,delivered:!1}])})})}}]})},X=()=>{if(l||n)return;let d=document.querySelector("#last");if(!d)return;!K(d)&&(m(!0),v("Services",{action:"getMessages",page:f+1,id:o.id,company:o.job}).then(O=>{O&&O.length>0?(r([...O.reverse(),...s]),m(!1),O.length<25&&E(!0)):E(!0)}),p(O=>O+1))};B("services:newMessage",d=>{if(o.id!==d.channelId||d.sender===A||S.airplaneMode)return;r([...s,{...d,timestamp:new Date}]);let I=document.querySelector(".chat-container");I.scrollTop=I.scrollHeight});const q=d=>{if(d)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(d)};return e(W,{children:i("div",{className:"animation-slide left",children:[i("div",{className:"chat-header",children:[e("div",{className:"back",onClick:()=>{C("messages"),N(null)},children:e(Z,{})}),i("div",{className:"user",children:[e("img",{src:o.icon??"./assets/img/no-pfp.png",className:"avatar"}),e("div",{className:"name",children:o.company??D(o.number)})]}),e(z,{className:"hidden"})]}),e("div",{className:"chat-container",onScroll:X,children:e("div",{className:"chat-body",children:s.map((d,I)=>e(oe,{index:I,messages:s,message:d,func:{isLocation:q}}))})}),i("div",{className:"chat-bottom",children:[e(w,{onClick:M}),i("div",{className:"input",children:[e(J,{placeholder:t("APPS.MESSAGES.PLACEHOLDER"),ref:b,value:h.content,onChange:d=>{U({content:d.target.value,attachments:h.attachments})},onKeyDown:d=>{d.key=="Enter"&&L()}}),h.content.length>0&&e("div",{className:"send",onClick:L,children:e(ee,{})})]})]})]})})}const oe=({messages:c,message:a,index:S,func:A})=>{var m;const{Data:o}=P.useContext(V);R(T.Settings);const N=R(T.PhoneNumber),[u]=o;let C,f,p,l=S===0?"last":"",E=a.sender===N?"self":"other",n=((m=c[S+1])==null?void 0:m.sender)===N?"self":"other";if(c[S+1]?f=Math.abs(a.timestamp-c[S+1].timestamp)/36e5:n=void 0,A.isLocation(a.content)){let s=a.content.match(/X=(-?\d*\.?\d*)Y/)[1],r=a.content.match(/Y=(-?\d*\.?\d*)!>/)[1];p={x:s,y:r}}return i("div",{className:`message ${E}`,id:l,"data-id":a.id,children:[C,a.delivered===!1?i("div",{className:"content-wrapper",children:[e("div",{className:"content",children:H(a.content)}),e(te,{})]}):p?i("div",{className:"location",onClick:()=>{T.App.set({name:"Maps",data:{location:[p.y,p.x],name:`${D(a.sender)}'s location`,icon:u.icon}})},children:[e("div",{className:"img",style:{backgroundImage:'url("https://img.gta5-mods.com/q95/images/mirror-park-garden/2b72f9-20160428154103_1.jpg")'}}),E==="other"&&i("div",{className:"sender",children:[D(a.sender)," ",t("APPS.MESSAGES.SENT_LOCATION")]})]}):a.content&&e("div",{className:"content",children:H(a.content)}),a.delivered===!1?e("div",{className:"status",children:t("APPS.MESSAGES.NOT_DELIVERED")}):c[S+1]&&f>6?e("div",{className:"date",children:_(a.timestamp)}):E!==n&&e("div",{className:"date",children:_(a.timestamp)})]},S)};function re(){const{View:c,Data:a}=P.useContext(V),[S,A]=c,[o,N]=a,u=R(y),[C,f]=P.useState([]);P.useEffect(()=>{v("Services",{action:"getCompanies"}).then(n=>{n&&f(n)})},[]);const p=n=>{var m;!((m=n==null?void 0:n.location)!=null&&m.coords)||!n.name||T.App.set({name:"Maps",data:{location:[n.location.coords.y,n.location.coords.x],name:n.name,icon:n.icon}})},l=(n,m)=>{u.Companies.Enabled&&g.PopUp.set({title:t("APPS.SERVICES.CALL_POPUP.TITLE"),description:t("APPS.SERVICES.CALL_POPUP.DESCRIPTION").format({name:Y(n)}),buttons:[{title:t("APPS.SERVICES.CALL_POPUP.CANCEL")},{title:t("APPS.SERVICES.CALL_POPUP.PROCEED"),cb:()=>{Q({company:n,companylabel:m})}}]})},E=n=>{v("Services",{action:"getChannelId",company:n.job}).then(m=>{m&&(N({icon:n.icon,company:n.name,job:n.job,id:m}),A("chat"))})};return B("services:updateOpen",n=>{if(!n)return;const{job:m,open:s}=n;f(r=>{const b=r.findIndex(h=>h.job===m);return b===-1?r:(r[b].open=s,[...r])})}),e("div",{className:"animation-slide right",children:e("div",{className:"companies-list",children:C.sort((n,m)=>n.open&&!m.open?-1:!n.open&&m.open?1:0).map((n,m)=>{var s,r,b,h;return i("div",{className:"item","data-open":n.open,children:[i("div",{className:"info",children:[n.icon&&e("div",{className:"icon",children:e("img",{src:n.icon})}),i("div",{className:"company-details",children:[e("div",{className:"title",children:n.name}),i("div",{className:"location",children:[e($,{}),(s=n.location)==null?void 0:s.name]})]})]}),n.open?i("div",{className:"actions",children:[n.customIcon&&e("div",{className:"custom-icon",onClick:()=>v("Services",{action:"customIconClick",company:n.job}),children:ne[n.customIcon]()}),((r=n.location)==null?void 0:r.coords)&&e(w,{onClick:()=>p(n)}),((b=u.Companies)==null?void 0:b.Enabled)!==!1&&n.canCall!==!1&&e(ae,{onClick:()=>l(n.job,n.name)}),n.canMessage!==!1&&e(F,{onClick:()=>E(n)})]}):i("div",{className:"actions",children:[((h=n.location)==null?void 0:h.coords)&&e(w,{onClick:()=>p(n)}),n.canMessage!==!1&&u.Companies.MessageOffline&&e(F,{onClick:()=>E(n)}),t("APPS.SERVICES.CLOSED")]})]},m)})})})}function de(){const{View:c,Data:a}=P.useContext(V),S=R(T.PhoneNumber),[A,o]=c,[N,u]=a,[C,f]=P.useState({personal:[],job:[]});P.useEffect(()=>{v("Services",{action:"getRecentMessages",page:0}).then(l=>{l&&f({personal:[...l.filter(E=>E.number===S)],job:[...l.filter(E=>E.number!==S)]})})},[]);const p=l=>{if(l)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(l)};return e("div",{className:"animation-slide right",children:i("div",{className:"company-messages-container",children:[i("section",{children:[e("div",{className:"title",children:t("APPS.SERVICES.YOUR_MESSAGES")}),e("div",{className:"content",children:C.personal&&C.personal.map((l,E)=>i("div",{className:"item",onClick:()=>{u({...N,icon:l.company.icon,company:l.company.name,job:l.company.job,id:l.id}),o("chat")},children:[e("img",{src:l.company.icon}),i("div",{className:"info",children:[i("div",{className:"info-header",children:[e("div",{className:"user",children:Y(l.company.name)}),i("div",{className:"right",children:[e("div",{className:"time",children:_(l.timestamp)}),e(G,{})]})]}),e("div",{className:"message",children:p(l.lastMessage)?t("APPS.MESSAGES.SENT_LOCATION_SHORT"):l.lastMessage})]})]},E))})]}),i("section",{children:[e("div",{className:"title",children:t("APPS.SERVICES.JOB_MESSAGES")}),e("div",{className:"content",children:C.job&&C.job.map((l,E)=>i("div",{className:"item",onClick:()=>{u({...N,id:l.id,icon:"./assets/img/no-pfp.png",number:l.number}),o("chat")},children:[e("img",{src:"./assets/img/no-pfp.png"}),i("div",{className:"info",children:[i("div",{className:"info-header",children:[e("div",{className:"user",children:D(l.number)}),i("div",{className:"right",children:[e("div",{className:"time",children:_(l.timestamp)}),e(G,{})]})]}),e("div",{className:"message",children:p(l.lastMessage)?t("APPS.MESSAGES.SENT_LOCATION_SHORT"):l.lastMessage})]})]},E+100))})]})]})})}function Se(){const{View:c}=P.useContext(V),a=R(y),[S,A]=c,[o,N]=P.useState([{icon:e($,{}),title:t("APPS.SERVICES.COMPANIES"),value:"companies"},{icon:e(ie,{}),title:t("APPS.SERVICES.MESSAGES"),value:"messages"}]);return P.useEffect(()=>{var u,C;((C=(u=a==null?void 0:a.Companies)==null?void 0:u.Management)==null?void 0:C.Enabled)!==!1&&N([...o,{icon:e(se,{}),title:t("APPS.SERVICES.ACTIONS"),value:"actions"}])},[]),e("div",{className:"companies-footer",children:o.map((u,C)=>i("div",{className:"item","data-active":S===u.value,onClick:()=>A(u.value),children:[u.icon,u.title]},C))})}const V=P.createContext(null);function he(){const[c,a]=P.useState("companies"),[S,A]=P.useState(null),o={companies:e(re,{}),actions:e(ce,{}),messages:e(de,{}),chat:e(le,{})};let N={actions:t("APPS.SERVICES.ACTIONS"),messages:t("APPS.SERVICES.MESSAGES"),companies:t("APPS.SERVICES.COMPANIES")};return e(V.Provider,{value:{View:[c,a],Data:[S,A]},children:i("div",{className:"companies-container",children:[c!=="chat"&&e("div",{className:"companies-header",children:e("div",{className:"title",children:N[c]})}),e("div",{className:"companies-body",children:o[c]}),c!=="chat"&&e(Se,{})]})})}export{V as ServicesContext,he as default};
