import{r as u,a as S,j as s}from"./jsx-runtime-f40812bf.js";import{f as y,d as N,u as w,L as t,p as I,C as O,h as Y,b as x,k as B}from"./Phone-3c5ec2e3.js";import{A as _,m as f,u as U,bh as F,bi as k,bj as D,bk as $}from"./index.esm-497ba86e.js";import{f as g,r as T}from"./number-28525126.js";function j({children:e,text:o}){const[m,h]=u.useState(!1);return S("div",{className:"tooltip-wrapper",onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:[e,s(_,{children:m&&s(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"tooltip top",children:s("div",{dangerouslySetInnerHTML:{__html:o}})})})]})}const b=u.createContext(null);function X(){var P;const e=U(Y),o=U(x.Settings),[m,h]=u.useState(0),[C,E]=u.useState([]),[R,r]=u.useState(""),[a,A]=u.useState("0"),[l,n]=u.useState(o==null?void 0:o.streamerMode);u.useEffect(()=>{y("Crypto",{action:"get"}).then(i=>{if(!i)return N("warning","No data received from Crypto NUI event");E(i)})},[]),w("crypto:updateCoins",i=>{if(!i)return N("warning","No data received from the update Crypto NUI event");E(i)}),u.useEffect(()=>h(C.reduce((i,d)=>i+(d.owned??0)*d.current_price,0)),[C]),u.useEffect(()=>{A(l?g("âˆ—".repeat(T(m,2).toString().length)):g(T(m,2)))},[m,l]);const c=i=>{let d={0:50,10:45,12:40,14:35},p=0;for(let v=0;v<Object.keys(d).length;v++)i.length>=parseInt(Object.keys(d)[v])&&(p=d[Object.keys(d)[v]]);return p};return S("div",{className:"crypto-container",children:[S("div",{className:"crypto-header",children:[s("img",{src:"./assets/img/icons/apps/Cryptopng.png",alt:"btc"}),t("APPS.CRYPTO.TITLE")]}),s(b.Provider,{value:{Coins:[C,E]},children:S("div",{className:"crypto-wrapper",children:[S("div",{className:"balance",children:[S("div",{className:"title",children:[t("APPS.CRYPTO.BALANCE"),s("div",{className:"icon",onClick:()=>n(!l),children:l?s(F,{}):s(k,{})})]}),s("div",{className:"amount",style:{fontSize:c(a.toString())},onClick:()=>n(!l),children:(P=e==null?void 0:e.CurrencyFormat)==null?void 0:P.replace("%s",a.toString())})]}),s("div",{className:"search",children:s(I,{placeholder:"Search Cryptocurrency",onChange:i=>r(i.target.value)})}),s(H,{search:R}),s("div",{className:"credits",children:"Powered by CoinGecko"})]})})]})}const H=({search:e})=>{const[o,m]=u.useState("balance"),[h,C]=u.useState(!0),E=["Name","Graph","Balance"],[R]=u.useContext(b).Coins;return s("div",{className:"holdings",children:S("div",{className:"items",children:[s("div",{className:"item filters",children:E.map((r,a)=>S("div",{className:"filter",onClick:()=>{if(m(r.toLowerCase()),o===r.toLowerCase())return C(!h);C(!0)},children:[r,r.toLowerCase()===o&&h?s(D,{}):s($,{})]},a))}),R.sort((r,a)=>o==="name"?h?r.name.localeCompare(a.name):a.name.localeCompare(r.name):o==="graph"?h?r.change_24h-a.change_24h:a.change_24h-r.change_24h:o==="balance"?h?(a.owned??0)*a.current_price-(r.owned??0)*r.current_price:(r.owned??0)*r.current_price-(a.owned??0)*a.current_price:0).filter(r=>r.name.toLowerCase().includes(e.toLowerCase())||r.symbol.toLowerCase().includes(e.toLowerCase())).map((r,a)=>s(M,{data:r},a))]})})},M=({data:e})=>{const[o,m]=u.useState(!1),[h,C]=u.useState(""),[E,R]=u.useContext(b).Coins,r=(l,n)=>{n>1?y("Crypto",{action:"buy",coin:l,amount:n}).then(c=>{if(c!=null&&c.success)return R(P=>P.map(i=>i.id===l?{...i,owned:(i.owned??0)+n/i.current_price,value:(i.value??0)+n,invested:(i.invested??0)+n}:i));c!=null&&c.msg&&setTimeout(()=>{O.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t(`APPS.CRYPTO.${c.msg}`),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{O.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:t("APPS.CRYPTO.BUY").toLowerCase(),currency:Y.value.CurrencyFormat.replace("%s","")}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)},a=(l,n,c)=>{c>0?y("Crypto",{action:"sell",coin:l,amount:c}).then(P=>{if(P!=null&&P.success)return R(i=>i.map(d=>d.id===l?{...d,owned:(d.owned??0)-n/d.current_price,value:(d.value??0)+n,invested:(d.invested??0)-n}:d));P!=null&&P.msg&&setTimeout(()=>{O.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t(`APPS.CRYPTO.${P.msg}`),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{O.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:t("APPS.CRYPTO.SELL").toLowerCase(),currency:Y.value.CurrencyFormat.replace("%s","")}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)},A=(l,n,c,P)=>{c>0?y("Crypto",{action:"transfer",coin:l,amount:c,number:P}).then(i=>{i!=null&&i.success&&setTimeout(()=>{O.PopUp.set({title:t("APPS.CRYPTO.SUCCESSFULLY_TRANSFERED_POPUP.TITLE"),description:t("APPS.CRYPTO.SUCCESSFULLY_TRANSFERED_POPUP.DESCRIPTION").format({amount:n,coin:e.symbol,number:B(P)}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]}),R(d=>d.map(p=>p.id===l?{...p,owned:(p.owned??0)-n/p.current_price,value:(p.value??0)+n,invested:(p.invested??0)-n}:p))},250),i!=null&&i.msg&&setTimeout(()=>{O.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t(`APPS.CRYPTO.${i.msg}`),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{O.PopUp.set({title:t("APPS.CRYPTO.ERROR"),description:t("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:t("APPS.CRYPTO.TRANSFER").toLowerCase(),currency:Y.value.CurrencyFormat.replace("%s","")}),buttons:[{title:t("APPS.CRYPTO.CLOSE")}]})},250)};return e.symbol=e.symbol.toUpperCase(),e.owned=e.owned??0,e.value=e.current_price*(e.owned??0),S("div",{className:"item",onClick:()=>m(!o),children:[S("div",{className:"top",children:[S("div",{className:"info",children:[s("img",{src:e.image,className:"icon",alt:"Icon"}),S("div",{className:"coin",children:[s("div",{className:"name",children:e.symbol}),s("div",{className:"symbol",children:e.name})]})]}),s(z,{data:e}),S("div",{className:"amount",children:[s("div",{className:"value",children:g(T(e.owned,4))}),S("div",{className:"asset",children:["$",g(T(e.value,2))]})]})]}),s(_,{children:o&&S(f.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"bottom",children:[s(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button fill",onClick:l=>{l.stopPropagation(),O.PopUp.set({title:t("APPS.CRYPTO.BUY_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.BUY_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:t("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",onChange:n=>C(n)},buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{C(n=>(r(e.id,parseFloat(n)),n))}}]})},children:t("APPS.CRYPTO.BUY")}),s(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button",onClick:l=>{l.stopPropagation(),O.PopUp.set({title:t("APPS.CRYPTO.SELL_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.SELL_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:t("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",onChange:n=>C(n)},buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{C(n=>{let c=parseFloat(n),P=c/e.current_price;return a(e.id,c,P),n})}}]})},children:t("APPS.CRYPTO.SELL")}),s(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button blue",onClick:l=>{l.stopPropagation(),O.PopUp.set({title:t("APPS.CRYPTO.TRANSFER_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.TRANSFER_POPUP.DESCRIPTION").format({coin:e.symbol}),input:{placeholder:t("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",onChange:n=>C(n)},buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.TRANSFER_POPUP.NEXT"),cb:()=>{C(n=>{let c=parseFloat(n),P=c/e.current_price;return O.ContactSelector.set({onSelect:i=>{if(!i)return N("warning","No contact selected? Cancelling request");A(e.id,c,P,i.number)}}),n})}}]})},children:t("APPS.CRYPTO.TRANSFER")}),s(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button red",onClick:l=>{l.stopPropagation(),O.PopUp.set({title:t("APPS.CRYPTO.SELL_ALL_POPUP.TITLE").format({coin:e.symbol}),description:t("APPS.CRYPTO.SELL_ALL_POPUP.DESCRIPTION").format({coin:e.symbol,amount:e.owned*e.current_price}),buttons:[{title:t("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:t("APPS.CRYPTO.BUY_POPUP.PROCEED"),color:"red",cb:()=>{let n=e.owned*e.current_price;a(e.id,n,e.owned)}}]})},children:t("APPS.CRYPTO.SELL_ALL")})]})})]})},z=e=>{if(!(e!=null&&e.data.prices))return null;let o=e.data.prices;const m=u.useRef(null),[h,C]=u.useState(null),[E,R]=u.useState(null);return o=o.slice(0,24),u.useEffect(()=>{if(!(m!=null&&m.current))return;const r=m.current;r.width=150,r.height=100;const a=r.getContext("2d");a.lineWidth=3;const A=Math.min(...o),n=Math.max(...o)-A,c=r.height-10;let P=0,i=r.height-5-(o[0]-A)/n*c;a.beginPath(),a.moveTo(P,i);const d=o[o.length-1]-o[0]>0?"green":"red";a.strokeStyle=d;for(let L=1;L<o.length;L++)P+=r.width/(o.length-1),i=r.height-5-(o[L]-A)/n*c,a.lineTo(P,i);a.stroke();const p=(o[o.length-1]-o[0])/o[0]*100;p>0?C(`<div style="color: var(--phone-color-green)">+${T(p,2)}%</div>`):p<0?C(`<div style="color: var(--phone-color-red)">${T(p,2)}%</div>`):C(`<div>${T(p,2)}%</div>`);let v=(e.data.value-e.data.invested)/e.data.invested*100;v>0?R(`<div style="color: var(--phone-color-green)">+${T(v,2)}%</div>`):v<0&&R(`<div style="color: var(--phone-color-red)">${T(v,2)}%</div>`)},[m,o]),s(j,{text:`$${T(e.data.current_price,2)} ${h??""} ${E??""}`,children:s("canvas",{ref:m})})};export{X as default};
