import{ae as ne,af as oe,am as ie,ag as ae,an as re,x as le,s as D,a3 as se,f as ue,g as de,y as j,a5 as ce,A as T,h as z,k as fe,a6 as he,j as pe,ac as k,ab as ge,l as S,V as me,T as ve,U as ye,Y as be,a9 as Se,P as $,G as U,o as we,c as xe,I as Ie,u as Te}from"./index-1c6b3dd3.js";import{c as Me,N as Re}from"./SelectMenu-49f9a701.js";import{N as Ce}from"./Input-d45cf124.js";import"./FocusDetector-bd94bb6c.js";import"./VirtualList-e7fe5725.js";import"./Empty-168292b7.js";import"./use-locale-119c58a2.js";import"./Suffix-067b8130.js";const Be=t=>{const{boxShadow2:a}=t;return{menuBoxShadow:a}},Ve=ne({name:"Mention",common:oe,peers:{InternalSelectMenu:ie,Input:ae},self:Be}),Ee=Ve;function Pe(t,a={debug:!1,useSelectionEnd:!1,checkWidthOverflow:!0}){const f=t.selectionStart!==null?t.selectionStart:0,h=t.selectionEnd!==null?t.selectionEnd:0,p=a.useSelectionEnd?h:f,P=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],w=navigator.userAgent.toLowerCase().includes("firefox");if(!re)throw new Error("textarea-caret-position#getCaretPosition should only be called in a browser");const d=a==null?void 0:a.debug;if(d){const c=document.querySelector("#input-textarea-caret-position-mirror-div");c!=null&&c.parentNode&&c.parentNode.removeChild(c)}const u=document.createElement("div");u.id="input-textarea-caret-position-mirror-div",document.body.appendChild(u);const r=u.style,i=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,g=t.nodeName==="INPUT";r.whiteSpace=g?"nowrap":"pre-wrap",g||(r.wordWrap="break-word"),r.position="absolute",d||(r.visibility="hidden"),P.forEach(c=>{if(g&&c==="lineHeight")if(i.boxSizing==="border-box"){const C=parseInt(i.height),B=parseInt(i.paddingTop)+parseInt(i.paddingBottom)+parseInt(i.borderTopWidth)+parseInt(i.borderBottomWidth),x=B+parseInt(i.lineHeight);C>x?r.lineHeight=`${C-B}px`:C===x?r.lineHeight=i.lineHeight:r.lineHeight="0"}else r.lineHeight=i.height;else r[c]=i[c]}),w?t.scrollHeight>parseInt(i.height)&&(r.overflowY="scroll"):r.overflow="hidden",u.textContent=t.value.substring(0,p),g&&u.textContent&&(u.textContent=u.textContent.replace(/\s/g,"Â "));const l=document.createElement("span");l.textContent=t.value.substring(p)||".",l.style.position="relative",l.style.left=`${-t.scrollLeft}px`,l.style.top=`${-t.scrollTop}px`,u.appendChild(l);const y={top:l.offsetTop+parseInt(i.borderTopWidth),left:l.offsetLeft+parseInt(i.borderLeftWidth),absolute:!1,height:parseInt(i.fontSize)*1.5};return d?l.style.backgroundColor="#aaa":document.body.removeChild(u),y.left>=t.clientWidth&&a.checkWidthOverflow&&(y.left=t.clientWidth),y}const Fe=le([D("mention","width: 100%; z-index: auto; position: relative;"),D("mention-menu",`
 box-shadow: var(--n-menu-box-shadow);
 `,[se({originalTransition:"background-color .3s var(--n-bezier), box-shadow .3s var(--n-bezier)"})])]),Ue=Object.assign(Object.assign({},j.props),{to:k.propTo,autosize:[Boolean,Object],options:{type:Array,default:[]},type:{type:String,default:"text"},separator:{type:String,validator:t=>t.length!==1?(Se("mention","`separator`'s length must be 1."),!1):!0,default:" "},bordered:{type:Boolean,default:void 0},disabled:Boolean,value:String,defaultValue:{type:String,default:""},loading:Boolean,prefix:{type:[String,Array],default:"@"},placeholder:{type:String,default:""},placement:{type:String,default:"bottom-start"},size:String,renderLabel:Function,status:String,"onUpdate:show":[Array,Function],onUpdateShow:[Array,Function],"onUpdate:value":[Array,Function],onUpdateValue:[Array,Function],onSearch:Function,onSelect:Function,onFocus:Function,onBlur:Function,internalDebug:Boolean}),Ae=ue({name:"Mention",props:Ue,setup(t){const{namespaceRef:a,mergedClsPrefixRef:f,mergedBorderedRef:h,inlineThemeDisabled:p}=de(t),P=j("Mention","-mention",Fe,Ee,t,f),w=ce(t),d=T(null),u=T(null),r=T(null),i=T("");let g=null,l=null,y=null;const c=z(()=>{const{value:e}=i;return t.options.filter(n=>e?typeof n.label=="string"?n.label.startsWith(e):typeof n.value=="string"?n.value.startsWith(e):!1:!0)}),C=z(()=>Me(c.value,{getKey:e=>e.value})),B=T(null),x=T(!1),W=T(t.defaultValue),_=fe(t,"value"),K=he(_,W),L=z(()=>{const{self:{menuBoxShadow:e}}=P.value;return{"--n-menu-box-shadow":e}}),M=p?pe("mention",void 0,L,t):void 0;function I(e){if(t.disabled)return;const{onUpdateShow:n,"onUpdate:show":o}=t;n&&U(n,e),o&&U(o,e),e||(g=null,l=null,y=null),x.value=e}function N(e){const{onUpdateValue:n,"onUpdate:value":o}=t,{nTriggerFormChange:s,nTriggerFormInput:m}=w;o&&U(o,e),n&&U(n,e),m(),s(),W.value=e}function A(){return t.type==="text"?d.value.inputElRef:d.value.textareaElRef}function H(){var e;const n=A();if(document.activeElement!==n){I(!1);return}const{selectionEnd:o}=n;if(o===null){I(!1);return}const s=n.value,{separator:m}=t,{prefix:R}=t,F=typeof R=="string"?[R]:R;for(let b=o-1;b>=0;--b){const v=s[b];if(v===m||v===`
`||v==="\r"){I(!1);return}if(F.includes(v)){const E=s.slice(b+1,o);I(!0),(e=t.onSearch)===null||e===void 0||e.call(t,E,v),i.value=E,g=v,l=b+1,y=o;return}}I(!1)}function Y(){const{value:e}=u;if(!e)return;const n=A(),o=Pe(n);o.left+=n.parentElement.offsetLeft,e.style.left=`${o.left}px`,e.style.top=`${o.top+o.height}px`}function q(){var e;x.value&&((e=r.value)===null||e===void 0||e.syncPosition())}function G(e){N(e),V()}function V(){setTimeout(()=>{Y(),H(),$().then(q)},0)}function X(e){var n,o;if(e.key==="ArrowLeft"||e.key==="ArrowRight"){if(!((n=d.value)===null||n===void 0)&&n.isCompositing)return;V()}else if(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="Enter"){if(!((o=d.value)===null||o===void 0)&&o.isCompositing)return;const{value:s}=B;if(x.value){if(s)if(e.preventDefault(),e.key==="ArrowUp")s.prev();else if(e.key==="ArrowDown")s.next();else{const m=s.getPendingTmNode();m?O(m):I(!1)}}else V()}}function J(e){const{onFocus:n}=t;n==null||n(e);const{nTriggerFormFocus:o}=w;o(),V()}function Q(){var e;(e=d.value)===null||e===void 0||e.focus()}function Z(){var e;(e=d.value)===null||e===void 0||e.blur()}function ee(e){const{onBlur:n}=t;n==null||n(e);const{nTriggerFormBlur:o}=w;o(),I(!1)}function O(e){var n;if(g===null||l===null||y===null)return;const{rawNode:{value:o=""}}=e,s=A(),m=s.value,{separator:R}=t,F=m.slice(y),b=F.startsWith(R),v=`${o}${b?"":R}`;N(m.slice(0,l)+v+F),(n=t.onSelect)===null||n===void 0||n.call(t,e.rawNode,g);const E=l+v.length+(b?1:0);$().then(()=>{s.selectionStart=E,s.selectionEnd=E,H()})}function te(){t.disabled||V()}return{namespace:a,mergedClsPrefix:f,mergedBordered:h,mergedSize:w.mergedSizeRef,mergedStatus:w.mergedStatusRef,mergedTheme:P,treeMate:C,selectMenuInstRef:B,inputInstRef:d,cursorRef:u,followerRef:r,showMenu:x,adjustedTo:k(t),isMounted:ge(),mergedValue:K,handleInputFocus:J,handleInputBlur:ee,handleInputUpdateValue:G,handleInputKeyDown:X,handleSelect:O,handleInputMouseDown:te,focus:Q,blur:Z,cssVars:p?void 0:L,themeClass:M==null?void 0:M.themeClass,onRender:M==null?void 0:M.onRender}},render(){const{mergedTheme:t,mergedClsPrefix:a,$slots:f}=this;return S("div",{class:`${a}-mention`},S(Ce,{status:this.mergedStatus,themeOverrides:t.peerOverrides.Input,theme:t.peers.Input,size:this.mergedSize,autosize:this.autosize,type:this.type,ref:"inputInstRef",placeholder:this.placeholder,onMousedown:this.handleInputMouseDown,onUpdateValue:this.handleInputUpdateValue,onKeydown:this.handleInputKeyDown,onFocus:this.handleInputFocus,onBlur:this.handleInputBlur,bordered:this.mergedBordered,disabled:this.disabled,value:this.mergedValue}),S(me,null,{default:()=>[S(ve,null,{default:()=>S("div",{style:{position:"absolute",width:0,height:0},ref:"cursorRef"})}),S(ye,{ref:"followerRef",placement:this.placement,show:this.showMenu,containerClass:this.namespace,to:this.adjustedTo,teleportDisabled:this.adjustedTo===k.tdkey},{default:()=>S(be,{name:"fade-in-scale-up-transition",appear:this.isMounted},{default:()=>{const{mergedTheme:h,onRender:p}=this;return p==null||p(),this.showMenu?S(Re,{clsPrefix:a,theme:h.peers.InternalSelectMenu,themeOverrides:h.peerOverrides.InternalSelectMenu,autoPending:!0,ref:"selectMenuInstRef",class:[`${a}-mention-menu`,this.themeClass],loading:this.loading,treeMate:this.treeMate,virtualScroll:!1,style:this.cssVars,onToggle:this.handleSelect,renderLabel:this.renderLabel},f):null}})})]}))}}),$e={__name:"Mention",props:{field:Object},setup(t){return(a,f)=>(we(),xe("div",null,[Ie(Te(Ae),{options:t.field.options,value:t.field.value,"onUpdate:value":f[0]||(f[0]=h=>t.field.value=h),"default-value":"@"},null,8,["options","value"])]))}};export{$e as default};
